(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/business/login/login"],{"0c8e":function(e,n,t){"use strict";(function(e,o,a){var s=t("47a9");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(t("7eb4")),r=s(t("ee10")),c={name:"login",data:function(){return{logoSrc:"",openid:"",session_key:"",setData:{},tipsContent:"为了及时获取订单状态，您是否想接收订单状态的消息提醒？",buttonConfirmText:"去开启消息提醒",buttonCancelText:"不需要提醒",maskShow:!1,pushClientid:""}},onLoad:function(){this.getBasicInforMation()},computed:{},created:function(){},methods:{getOpenID:function(){this.maskShow=!0;var n=this;e.login({provider:"weixin",success:function(){var t=(0,r.default)(i.default.mark((function t(a){var s;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("wxcode：",a),t.next=3,o.callFunction({name:"getOpenID",data:{code:a.code,encryptedData:n.encryptedData,iv:n.iv}});case 3:s=t.sent,console.log("callFunctionResult",s),n.openid=s.result.openid,n.session_key=s.result.session_key,n.phoneNumber=s.result.phoneNumber,console.log("openid",n.openid),console.log("session_key",n.session_key),console.log("phoneNumber",n.phoneNumber),e.setStorageSync("openID",n.openid),e.setStorageSync("session_key",n.session_key),e.setStorageSync("phoneNumber",n.phoneNumber),n.addUser(),e.switchTab({url:"/pages/my/my"});case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),fail:function(n){e.showToast({title:"授权失败："+n}),console.log()}})},getPhoneNumber:function(n){"getPhoneNumber:ok"===n.detail.errMsg?(this.encryptedData=n.detail.encryptedData,this.iv=n.detail.iv,this.getOpenID()):e.showToast({title:"获取手机号码失败",icon:"none"})},getUserInfo:function(){this.$options.methods.getOpenID(),e.showLoading({title:"处理中..."}),console.log("this.$options.methods.getOpenID() 后");var n=this;a.getUserProfile({desc:"用于完善会员资料",success:function(t){n.setData={userInfo:t.userInfo,rawData:t.rawData,signature:t.signature,encryptedData:t.encryptedData,iv:t.iv,hasUserInfo:!0},console.log("setData:"+JSON.stringify(n.setData)),e.setStorageSync("setData",n.setData),e.setStorageSync("userInfo",n.setData.userInfo),e.setStorageSync("signature",n.setData.signature),e.setStorageSync("encryptedData",n.setData.encryptedData),e.hideLoading()},fail:function(){e.hideLoading(),e.showToast({title:"为了更好的功能体验，请先登录授权！",icon:"none"}),console.log("请点击授权进行登录！")},complete:function(){o.callFunction({name:"getUser",data:{openID:e.getStorageSync("openID")}}).then((function(t){console.log("getUserInfo getUser:",t.result.data),console.log('uni.getStorageSync("openID")',e.getStorageSync("openID")),0==t.result.data.length?(console.log("插入一条数据",{openID:e.getStorageSync("openID"),nickName:e.getStorageSync("setData").userInfo.nickName,avatarUrl:e.getStorageSync("setData").userInfo.avatarUrl,pushClientid:n.pushClientid,username:e.getStorageSync("setData").userInfo.nickName,level:1,is_block_user:0,isEnable:1}),console.log('uni.getStorageSync("setData"):',e.getStorageSync("setData")),o.callFunction({name:"addUser",data:{openID:e.getStorageSync("openID"),nickName:e.getStorageSync("setData").userInfo.nickName,avatarUrl:e.getStorageSync("setData").userInfo.avatarUrl,pushClientid:n.pushClientid,username:e.getStorageSync("setData").userInfo.nickName,level:1,is_block_user:0,isEnable:1}}).then((function(e){console.log("新增一条用户数据：",e)})).catch((function(e){console.log("getUser addUser err:",e)})).finally((function(){console.log("that.openID :".concat(e.getStorageSync("openID"))),o.callFunction({name:"getUser",data:{openID:e.getStorageSync("openID")},success:function(n){console.log("getUser user res.data.result:".concat(n.result.data)),e.setStorageSync("userID",n.result.data[0].userID)}})}))):(console.log("已有数据不再插入"),e.setStorageSync("userID",t.result.data[0].userID)),console.log(t)})).catch((function(e){console.log(e)})),n.maskShow=!1,e.switchTab({url:"/pages/home/home"})}})},addUser:function(){o.callFunction({name:"addUser",data:{openID:this.openid,username:"",phone:this.phoneNumber,level:1,is_block_user:0,isEnable:1},success:function(e){console.log("res.result.data:",e.result.data)}})},goto:function(n){e.navigateTo({animationType:"slide-in-bottom",animationDuration:200,url:n})},getBasicInforMation:function(){var e=this;o.callFunction({name:"getBasicInformation",data:{isEnable:!0},success:function(n){e.logoSrc=n.result.data[0].logo.url}})}},beforeDestroy:function(){}};n.default=c}).call(this,t("df3c")["default"],t("861b")["uniCloud"],t("3223")["default"])},"1a5d":function(e,n,t){"use strict";var o=t("5155"),a=t.n(o);a.a},"4dbf":function(e,n,t){"use strict";(function(e,n){var o=t("47a9");t("34db"),t("3c60"),t("c891"),t("861b");o(t("3240"));var a=o(t("854c"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(a.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},5155:function(e,n,t){},"69b4":function(e,n,t){"use strict";t.r(n);var o=t("0c8e"),a=t.n(o);for(var s in o)["default"].indexOf(s)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=a.a},"854c":function(e,n,t){"use strict";t.r(n);var o=t("9e20"),a=t("69b4");for(var s in a)["default"].indexOf(s)<0&&function(e){t.d(n,e,(function(){return a[e]}))}(s);t("1a5d");var i=t("828b"),r=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=r.exports},"9e20":function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return o}));var o={"u-Image":function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u--image/u--image")]).then(t.bind(null,"494a"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"8103"))},uOverlay:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(t.bind(null,"ff06"))}},a=function(){var e=this.$createElement;this._self._c},s=[]}},[["4dbf","common/runtime","common/vendor"]]]);