(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/business/payOrder/payOrder"],{"065c":function(e,o,n){"use strict";var t=n("0cc5"),r=n.n(t);r.a},"0cc5":function(e,o,n){},"115b":function(e,o,n){"use strict";(function(e,t){var r=n("47a9");Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=r(n("7eb4")),s=r(n("ee10")),u=r(n("7ca3")),i=n("8f59");function c(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}function d(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?c(Object(n),!0).forEach((function(o){(0,u.default)(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}var l={name:"orderDetail",data:function(){return{total_fee:1,order_no:"",out_trade_no:"",description:"测试订单",type:"goods",custom:{},goodsInfo:"",orderGoodsCount:1,orderGoodsID:"",originalPrice:0,favourPrice:0,amountPayable:0,actuallyPaid:0,orderDiscountAmount:0,discountMethod:0,submitOrderData:"",scrollTop:0,mode:"square",iconStyle:{fontSize:"40rpx",color:"#1296db",backgroundColor:"#fffff"},orderID:"",reservationID:"",payResult:0,maskShow:!1,payResultInfo:"",sharerOpenID:""}},methods:d(d({},(0,i.mapActions)(["setNavigationBarTitle"])),{},{onPageScroll:function(e){this.scrollTop=e.scrollTop},goto:function(o){e.navigateTo({url:o,animationType:"slide-in-right",animationDuration:300})},open:function(){var e=this;return(0,s.default)(a.default.mark((function o(){return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("this.order_no：",e.order_no),e.out_trade_no="".concat(e.order_no,"-").concat(Math.floor(9*Math.random())+1),o.next=4,e.$refs.uniPay.open({total_fee:100*e.total_fee,order_no:e.order_no,out_trade_no:e.out_trade_no,description:e.goodsInfo.title,type:e.type,custom:{orderGoodsID:e.goodsInfo,orderGoodsCount:1,originalPrice:e.originalPrice,favourPrice:e.favourPrice,amountPayable:e.amountPayable,sharerOpenID:e.sharerOpenID}});case 4:e.payResultInfo=o.sent,console.log("open() payResultInfo:",e.payResultInfo);case 6:case"end":return o.stop()}}),o)})))()},payOrder:function(){this.createOrder()},onCreate:function(e){console.log("uni-pay create: ",e)},onSuccess:function(o){e.showToast({title:"支付成功"}),console.log("uni-pay success: ",o),o.user_order_success?(console.log("uni-pay onSuccess 支付成功1"),this.goto("/uni_modules/uni-pay/pages/success/success"),this.getSubscribe()):console.log("uni-pay onSuccess 支付成功2")},onFail:function(o){console.log("uni-pay onFail: ",o),console.log("onFail 支付失败"),e.showToast({title:"支付失败"}),this.goto("/pages/business/order/order?orderStatus=1")},onCancel:function(o){console.log("uni-pay onCancel: ",o),e.showToast({title:"取消支付"})},onMounted:function(e){this.init()},init:function(){return(0,s.default)(a.default.mark((function e(){return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},addReservationRecord:function(){var o=this;t.callFunction({name:"addReservationRecord",data:{openID:e.getStorageSync("openID"),userID:e.getStorageSync("userID"),expectedAppointmentDateTime:new Date(e.getStorageSync("submitOrderData").expectedAppointmentDateTime).valueOf(),actualServiceDateTime:e.getStorageSync("submitOrderData").actualServiceDateTime,paymentMethod:e.getStorageSync("submitOrderData").paymentMethod,cardID:e.getStorageSync("orderSubmitSelectCardInfo")._id,cardNumber:e.getStorageSync("submitOrderData").cardNumber,isDone:!1,isEnable:!0},success:function(n){console.log("submit:",n.result.data),o.reservationID=n.result.data.id,console.log("addReservationRecord reservationID：",o.reservationID),e.showToast({title:"加载中",mask:!0,duration:2e3})}})},randomNum:function(e){for(var o="",n=0;n<e;n++)o+=Math.floor(10*Math.random());return o},createOrder:function(){var o=this;o.order_no=Date.now()+e.getStorageSync("openID").substr(-15),t.callFunction({name:"order",data:{methods:"createOrder",orderType:1,orderNo:o.order_no,orderGoodsCount:o.orderGoodsCount,orderGoodsID:o.orderGoodsID,openID:e.getStorageSync("openID"),userID:e.getStorageSync("userID"),sharerOpenID:o.sharerOpenID},success:function(e){console.log("createOrder res:",e),console.log("createOrder orderID：",e.result.data),o.orderID=e.result.data.id,o.open()}})},getYMDHMS:function(e){var o=new Date(e),n=o.getFullYear()+"-",t=(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1)+"-",r=(o.getDate()<10?"0"+o.getDate():o.getDate())+" ",a=(o.getHours()<10?"0"+o.getHours():o.getHours())+":",s=(o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes())+":",u=o.getSeconds()<10?"0"+o.getSeconds():o.getSeconds(),i=n+t+r+a+s+u;return i},getSubscribe:function(){var o=this;e.requestSubscribeMessage({tmplIds:["iOWPa9J4g-uRHrZUG62wxhWqsb0YU265UToPTV7eZGQ"],success:function(n){for(var t in n)"accept"==n[t]&&(e.showToast({title:"已允许消息推送"}),o.sendMessage())},fail:function(e){console.log("订阅消息 失败 ",e)}})},sendMessage:function(){t.callFunction({name:"sendSubscriptionIDMessage",data:{openId:"oTDxt5Rg2FLfsGHXY9BJ2lsBmog4",data:{character_string1:{value:"12317239817239813"},name4:{value:"商品名称"},amount2:{value:"1"},phrase8:{value:"已支付"},date3:{value:"2023-06-12 10:00:00"}},teampleName:"订单支付成功通知"},success:function(e){console.log(e)}})}}),created:function(){},components:{},onLoad:function(o){var n=this;if(console.log("当前页面:payOrder"),this.submitOrderData=e.getStorageSync("submitOrderData"),this.workerID=o.workerID,console.log("payOrder 师傅ID：".concat(this.workerID)),this.orderGoodsID=o.goodsID,console.log("payOrder orderGoodsID：".concat(this.orderGoodsID)),o.selectedGoods){var r=JSON.parse(decodeURIComponent(o.selectedGoods));console.log("pay order所选商品数组-多个商品：".concat(r)),this.goodsInfo=r,this.total_fee=r.reduce((function(e,o){return e+o.price*o.quantity}),0)}else this.goodsInfo=JSON.parse(decodeURIComponent(o.selectedGoods)),console.log("pay order所选商品数组-单个商品：".concat(o.selectedGoods)),this.goodsInfo=selectedGoods,this.total_fee=selectedGoods.price*selectedGoods.quantity;t.callFunction({name:"goods",data:{methods:"getGoodsDetail",goodsID:this.goodsID,isEnable:!0},success:function(e){n.goodsInfo=e.result.data[0],n.total_fee=n.goodsInfo.favourPrice,console.log("pay Order getGoodsDetail res:".concat(JSON.stringify(e.result.data[0])))}}),this.sharerOpenID=e.getStorageSync("sharerInfo")["sharerOpenID"],void 0==this.sharerOpenID||""==this.sharerOpenID?console.log("sharerOpenID 为空，该商品无人分享"):console.log("sharerOpenID 不为空，分享者ID为："+this.sharerOpenID)},watch:{}};o.default=l}).call(this,n("df3c")["default"],n("861b")["uniCloud"])},"2bf5":function(e,o,n){"use strict";n.r(o);var t=n("da10"),r=n("60fe");for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(o,e,(function(){return r[e]}))}(a);n("065c");var s=n("828b"),u=Object(s["a"])(r["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],void 0);o["default"]=u.exports},"60fe":function(e,o,n){"use strict";n.r(o);var t=n("115b"),r=n.n(t);for(var a in t)["default"].indexOf(a)<0&&function(e){n.d(o,e,(function(){return t[e]}))}(a);o["default"]=r.a},b6f6:function(e,o,n){"use strict";(function(e,o){var t=n("47a9");n("34db"),n("3c60"),n("c891"),n("861b");t(n("3240"));var r=t(n("2bf5"));e.__webpack_require_UNI_MP_PLUGIN__=n,o(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},da10:function(e,o,n){"use strict";n.d(o,"b",(function(){return r})),n.d(o,"c",(function(){return a})),n.d(o,"a",(function(){return t}));var t={uOverlay:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(n.bind(null,"ff06"))},uniPay:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-pay/components/uni-pay/uni-pay")]).then(n.bind(null,"f909"))},uniCard:function(){return n.e("uni_modules/uni-card/components/uni-card/uni-card").then(n.bind(null,"2d19"))},uRow:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-row/u-row")]).then(n.bind(null,"926a"))},uCol:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-col/u-col")]).then(n.bind(null,"7108"))},"u-Image":function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u--image/u--image")]).then(n.bind(null,"494a"))},uDivider:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-divider/u-divider")]).then(n.bind(null,"7159"))},uButton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-button/u-button")]).then(n.bind(null,"8103"))},uBackTop:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-back-top/u-back-top")]).then(n.bind(null,"8985"))}},r=function(){var e=this,o=e.$createElement;e._self._c;e._isMounted||(e.e0=function(o){e.maskShow=!1})},a=[]}},[["b6f6","common/runtime","common/vendor"]]]);