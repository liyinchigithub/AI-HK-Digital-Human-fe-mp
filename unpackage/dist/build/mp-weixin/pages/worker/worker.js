(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/worker/worker"],{6599:function(e,t,o){"use strict";(function(e,t){var n=o("47a9");o("34db"),o("3c60"),o("c891"),o("861b");n(o("3240"));var i=n(o("e131"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(i.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"89dd":function(e,t,o){"use strict";var n=o("93de"),i=o.n(n);i.a},"8b32":function(e,t,o){"use strict";o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return n}));var n={uRow:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-row/u-row")]).then(o.bind(null,"926a"))},uCol:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-col/u-col")]).then(o.bind(null,"7108"))},"u-Text":function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u--text/u--text")]).then(o.bind(null,"2e88"))},uIcon:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(o.bind(null,"47d7"))},uSearch:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-search/u-search")]).then(o.bind(null,"430a"))},uActionSheet:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-action-sheet/u-action-sheet")]).then(o.bind(null,"0a2e"))},uEmpty:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-empty/u-empty")]).then(o.bind(null,"5310"))},uTag:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-tag/u-tag")]).then(o.bind(null,"495f"))},uOverlay:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-overlay/u-overlay")]).then(o.bind(null,"ff06"))},uPopup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(o.bind(null,"da30"))},uNumberBox:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-number-box/u-number-box")]).then(o.bind(null,"5e7f"))},uBackTop:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-back-top/u-back-top")]).then(o.bind(null,"8985"))}},i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.showActionSheet=!0},e.e1=function(t){e.showActionSheet=!0},e.e2=function(t){e.showActionSheet=!1},e.e3=function(t){e.isSearching=!1},e.e4=function(t){e.showGoodsSelect=!1})},r=[]},"93de":function(e,t,o){},e131:function(e,t,o){"use strict";o.r(t);var n=o("8b32"),i=o("f957");for(var r in i)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return i[e]}))}(r);o("89dd");var s=o("828b"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=c.exports},e717:function(e,t,o){"use strict";(function(e,n){var i=o("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(o("7eb4")),s=i(o("7ca3")),c=i(o("ee10")),a=i(o("3387"));function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){(0,s.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var d={data:function(){return{screenHeight:0,screenWidth:0,isEmpty:!1,workerID:"",goodsID:"",searchVal:"",worker:{},isSearching:!1,title:"worker-list",listData:[],renderImage:!1,scrollTop:0,mode:"square",iconStyle:{fontSize:"32rpx",color:"#71d5a1"},pageNum:1,pageSize:7,total:0,index:"",hasMoreWorkers:!0,showActionSheet:!1,cities:[],selectedCityCurrent:"",selectedCityCurrentID:"",showGoodsSelect:!1,goodsListData:[],totalPrice:0}},methods:{fetchCities:function(){var t=this;return(0,c.default)(r.default.mark((function o(){var n;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.callFunction({name:"getCities",data:{methods:"getCities"}});case 3:n=o.sent,0===n.result.code?t.cities=n.result.data.map((function(e){return{name:e.cityName,value:e._id}})):console.error(n.result.message),o.next=10;break;case 7:o.prev=7,o.t0=o["catch"](0),console.error("获取城市数据失败",o.t0);case 10:case"end":return o.stop()}}),o,null,[[0,7]])})))()},selectCity:function(e){this.selectedCityCurrent=e.name,this.showActionSheet=!1,console.log("this.selectedCityCurrent:",this.selectedCityCurrent),this.selectedCityCurrentID=e.value,console.log("this.selectedCityCurrentID",e.value),this.getListData(e.value)},search:function(t){if(this.searchVal.trim()){var o=this;console.log(t),o.isSearching=!0,e.callFunction({name:"worker",data:{methods:"getWorkersSearch",isEnable:!0,username:o.searchVal,pageNum:o.pageNum,pageSize:o.pageSize},success:function(e){o.listData=e.result.data,console.log("res:",e),console.log("空数据"),console.log("that.listData:",o.listData),0==o.listData.length?o.isEmpty=!0:o.isEmpty=!1,o.isSearching=!1},fail:function(e){console.log("getWorkersSearch err",e),o.isEmpty=!0,o.isSearching=!1}})}else this.getListData(this.selectedCityCurrentID)},clear:function(){this.searchVal="",this.isEmpty=!1},getListData:function(t){this.pageNum=1,this.isSearching=!0;var o=this;e.callFunction({name:"worker",data:{methods:"getWorkers",cityName:o.selectedCityCurrent,cityID:t,sortType:"created",isEnable:!0,pageNum:o.pageNum,pageSize:o.pageSize},success:function(e){o.listData=e.result.data,console.log("that.listData:",o.listData),0==o.listData.length?o.isEmpty=!0:o.isEmpty=!1,o.isSearching=!1},failure:function(e){console.log("getListData err",e),o.isEmpty=!0,o.isSearching=!1}})},previewImageSingle:function(e){n.previewImage({current:0,urls:[e],longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},previewImageMultiple:function(e){var t=e.map((function(e){return e.url}));n.previewImage({current:0,urls:t,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}})},loadMoreWorkers:function(){var t=this;this.hasMoreWorkers&&(this.pageNum+=1,e.callFunction({name:"worker",data:{methods:"getWorkers",cityName:this.selectedCityCurrent,cityID:this.selectedCityCurrentID,sortType:"created",isEnable:!0,pageNum:this.pageNum,pageSize:this.pageSize},success:function(e){var o=e.result.data||[];o.length<t.pageSize&&(t.hasMoreWorkers=!1,console.log("Loaded more workers:",o)),t.listData=t.listData.concat(o)},fail:function(e){console.log("getWorkers err",e)}}))},handleClick:function(e,t){this.goto("/pages/business/workerDetail/workerDetail?workerID=".concat(t))},toOrder:function(e){this.workerID=e,console.log("this.workerID:",this.workerID),this.isHomeGoTo?(n.navigateTo({url:"/pages/business/payOrder/payOrder?workerID=".concat(this.workerID,"&goodsID=").concat(this.goodsID)}),console.log("从首页商品（项目）跳转过来，商品ID:",this.goodsID)):(this.showGoodsSelect=!0,console.log("不是从首页商品（项目）跳转过来"))},getGoodsData:function(t){var o=this;e.callFunction({name:"goods",data:{methods:"getGoods",sortType:t,pageNum:o.pageNum,pageSize:o.pageSize+50,cityName:n.getStorageSync("cityName"),cityID:n.getStorageSync("cityID"),isEnable:!0},success:function(e){console.log("worker getGoods res.result.data:",e.result.data),o.goodsListData=e.result.data.map((function(e){return l(l({},e),{},{quantity:e.quantity||0})}))},fail:function(e){console.log("getGoodsData err",e)}})},calculateTotalPrice:function(){this.totalPrice=this.goodsListData.reduce((function(e,t){var o=Number(t.favourPrice),n=Number(t.quantity)||0;return console.log("worker calculateTotalPrice total:",e),console.log("worker calculateTotalPrice goods.favourPrice:",o),console.log("worker calculateTotalPrice goods.quantity:",n),e+o*n}),0),console.log("worker calculateTotalPrice this.totalPrice:",this.totalPrice)},debounceCalculateTotalPrice:a.default.debounce((function(){this.calculateTotalPrice()}),300),submitOrder:function(){console.log("订单提交");var e=this.goodsListData.filter((function(e){return e.quantity>0})).map((function(e){return{id:e._id,quantity:e.quantity,price:e.favourPrice}}));console.log("worker selectedGoods:",e),n.navigateTo({url:"/pages/business/payOrder/payOrder?selectedGoods=".concat(encodeURIComponent(JSON.stringify(e)))})},goto:function(e){n.navigateTo({url:e})}},onReachBottom:function(){this.loadMoreWorkers(),console.log("Reached bottom, loading more workers...")},created:function(){""==this.selectedCityCurrent||void 0==this.selectedCityCurrent||null==this.selectedCityCurrent?(this.selectedCityCurrentID=n.getStorageSync("cityID"),console.log("worker selectedCityCurrentID为空获取缓存城市ID:",this.selectedCityCurrentID)):console.log("worker 城市ID不为空 this.selectedCityCurrentID:",this.selectedCityCurrentID),this.getGoodsData(0),this.getListData(this.selectedCityCurrentID)},onLoad:function(e){this.screenHeight=n.getSystemInfoSync().windowHeight,this.screenWidth=n.getSystemInfoSync().windowWidth,this.fetchCities(),this.selectedCityCurrent=n.getStorageSync("cityName"),console.log("this.selectedCityCurrent:",this.selectedCityCurrent)},onShow:function(){this.isHomeGoTo=n.getStorageSync("isHomeGoTo"),this.goodsID=n.getStorageSync("goodsID"),console.log("worker this.isHomeGoTo:",this.isHomeGoTo),console.log("worker this.goodsID:",this.goodsID),this.isHomeGoTo=n.getStorageSync("isHomeGoTo"),this.goodsID=n.getStorageSync("goodsID"),console.log("worker this.isHomeGoTo:",this.isHomeGoTo),console.log("worker this.goodsID:",this.goodsID)},onPullDownRefresh:function(){},onShareAppMessage:function(){return{title:"师傅服务平台-用户端",path:"/pages/business/brand/brand"}},onShareTimeline:function(){return{title:"师傅服务平台-用户端",path:"/pages/business/brand/brand",imageUrl:"https://mp-e51575a6-5952-4ad5-bb31-45ff909d7f65.cdn.bspapp.com/cloudstorage/c89fedc8-0f75-4e8e-b151-ce90a17e7ce3.jpg"}}};t.default=d}).call(this,o("861b")["uniCloud"],o("df3c")["default"])},f957:function(e,t,o){"use strict";o.r(t);var n=o("e717"),i=o.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=i.a}},[["6599","common/runtime","common/vendor"]]]);