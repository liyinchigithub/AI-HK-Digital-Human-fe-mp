(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-home-home2"],{"0cb9":function(n,e,t){var a=t("c86c");e=a(!1),e.push([n.i,'\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 样式部分保持不变 */.container[data-v-1b1ec11a]{height:100vh;display:flex;flex-direction:column}.message-list[data-v-1b1ec11a]{flex:1;padding:%?20?%;background-color:#f5f5f5}.message-item[data-v-1b1ec11a]{margin:%?20?% 0;max-width:80%}.message-content[data-v-1b1ec11a]{padding:%?20?%;border-radius:%?10?%;font-size:%?28?%;line-height:1.5}.user-message[data-v-1b1ec11a]{margin-left:auto}.user-message .message-content[data-v-1b1ec11a]{background-color:#007aff;color:#fff}.ai-message .message-content[data-v-1b1ec11a]{background-color:#fff;border:%?1?% solid #eee}.message-time[data-v-1b1ec11a]{font-size:%?20?%;color:#999;margin-top:%?10?%;text-align:right}.think-message .message-content[data-v-1b1ec11a]{background-color:#fff3d4!important;border:%?1?% solid #ffe6b3}.message-item[class*="-message"][data-v-1b1ec11a]{margin:%?20?% 0;max-width:90%}.ai-message[data-v-1b1ec11a]{max-width:85%}.input-area[data-v-1b1ec11a]{display:flex;padding:%?20?%;background-color:#fff;border-top:%?1?% solid #eee}.input[data-v-1b1ec11a]{flex:1;border:%?1?% solid #ddd;border-radius:%?40?%;padding:%?15?% %?30?%;margin-right:%?20?%}.send-button[data-v-1b1ec11a]{background-color:#007aff;color:#fff;border-radius:%?40?%;padding:0 %?40?%;transition:opacity .3s}.send-button[disabled][data-v-1b1ec11a]{opacity:.6}.loading-text[data-v-1b1ec11a]{color:#999;text-align:center;padding:%?20?%}.voice-btn[data-v-1b1ec11a]{position:fixed;margin-top:%?20?%;bottom:%?40?%;left:50%;-webkit-transform:translateX(-50%) scale(1);transform:translateX(-50%) scale(1);width:%?150?%;height:%?150?%;border-radius:50%;background:linear-gradient(90deg,#cd56ff,#833ad6);border:%?4?% solid rgba(250,121,255,.8);box-shadow:0 %?7?% %?18?% 0 rgba(107,14,195,.38);background-image:url(/static/语音.png);background-size:%?80?% %?80?%;background-position:50%;background-repeat:no-repeat;z-index:9999}.voice-btn.recording[data-v-1b1ec11a]{background:#ff4d4d;-webkit-animation:pulse-data-v-1b1ec11a 1.5s infinite;animation:pulse-data-v-1b1ec11a 1.5s infinite;background-image:url(/static/语音.png);background-size:%?80?% %?80?%;background-position:50%;background-repeat:no-repeat}@-webkit-keyframes pulse-data-v-1b1ec11a{0%{-webkit-transform:translateX(-50%) scale(1);transform:translateX(-50%) scale(1)}50%{-webkit-transform:translateX(-50%) scale(1.1);transform:translateX(-50%) scale(1.1)}100%{-webkit-transform:translateX(-50%) scale(1);transform:translateX(-50%) scale(1)}}@keyframes pulse-data-v-1b1ec11a{0%{-webkit-transform:translateX(-50%) scale(1);transform:translateX(-50%) scale(1)}50%{-webkit-transform:translateX(-50%) scale(1.1);transform:translateX(-50%) scale(1.1)}100%{-webkit-transform:translateX(-50%) scale(1);transform:translateX(-50%) scale(1)}}',""]),n.exports=e},"117e":function(n,e,t){"use strict";t("6a54");var a=t("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,t("0c26"),t("aa9c"),t("c223"),t("795c"),t("c9b5"),t("bf0f"),t("ab80"),t("5c47"),t("dfcf"),t("2797"),t("9db6");var o=a(t("2634")),s=a(t("2fdc")),r=null;if("mp-weixin"===uni.getSystemInfoSync().platform){var i=requirePlugin("WechatSI");r=i.getRecordRecognitionManager()}var c={data:function(){return{messages:[],inputText:"",loading:!1,scrollTop:0,isRecording:!1}},methods:{sendMessage:function(){var n=this;return(0,s.default)((0,o.default)().mark((function e(){var t,a,s,r;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.inputText.trim()&&!n.loading){e.next=2;break}return e.abrupt("return");case 2:t={role:"user",content:n.inputText,time:n.getCurrentTime()},n.messages.push(t),n.inputText="",n.scrollToBottom();try{n.loading=!0,a={role:"ai",content:"",time:n.getCurrentTime()},n.messages.push(a),s=n.messages.length-1,r=uni.request({url:"https://homechat-effassits-popgjiyphu.cn-hangzhou.fcapp.run/v1/chat/completions",method:"POST",header:{"Content-Type":"application/json",token:uni.getStorageSync("token")||"",Accept:"text/event-stream","Accept-Charset":"utf-8"},data:{messages:[{role:"user",content:t.content}],stream:!0},enableChunked:!0,success:function(e){if(console.log("请求成功:",e),e.data)if("string"!==typeof e.data){if(e.data&&"function"===typeof e.data.on){var t="",a=new TextDecoder("utf-8");e.data.on("data",(function(e){try{var o=a.decode(e,{stream:!0});t+=o,n.processStreamData(t,s)}catch(r){console.error("处理数据块出错:",r)}})),e.data.on("end",(function(){n.loading=!1})),e.data.on("error",(function(e){n.handleError("数据流错误")}))}}else n.processH5Response(e.data,s);else n.handleError("响应数据为空")},fail:function(e){n.handleError("请求失败: ".concat(e.errMsg))}}),n.requestTask=r}catch(o){console.error("捕获到异常:",o),n.handleError("系统错误: ".concat(o.message))}case 7:case"end":return e.stop()}}),e)})))()},getCurrentTime:function(){var n=new Date;return"".concat(n.getHours(),":").concat(n.getMinutes().toString().padStart(2,"0"))},scrollToBottom:function(){var n=this;this.$nextTick((function(){var e=uni.createSelectorQuery().in(n);e.select(".message-list").boundingClientRect(),e.exec((function(e){var t;null!==e&&void 0!==e&&null!==(t=e[0])&&void 0!==t&&t.height&&(n.scrollTop=e[0].height+Math.random())}))}))},initVoiceManager:function(){var n=this;"mp-weixin"===uni.getSystemInfoSync().platform&&r&&(r.onStart=function(n){console.log("成功开始录音识别",n)},r.onStop=function(e){console.log("录音文件路径:",e.tempFilePath),console.log("识别结果:",e.result),e.result&&(n.inputText=e.result,n.sendMessage())},r.onError=function(n){console.error("语音识别错误:",n.msg),uni.showToast({title:"语音识别失败",icon:"none"})})},processStreamData:function(n,e){var t=this,a=this.messages[e].content||"",o=n.split(/\n\n+/);n=o.pop()||"",o.forEach((function(n){if(n.startsWith("data: ")){var o=n.substring(6).trim();if("[DONE]"===o)return void(t.loading=!1);try{var s,r,i,c=JSON.parse(o),l=(null===(s=c.choices)||void 0===s||null===(r=s[0])||void 0===r||null===(i=r.delta)||void 0===i?void 0:i.content)||"";l&&(a+=l,t.messages[e].content=a,t.$forceUpdate(),t.scrollToBottom())}catch(d){console.error("解析JSON失败:",d,"原始数据:",o)}}}))},processH5Response:function(n,e){var t=this,a="",o=n.split(/\n\n+/);o.forEach((function(n){if(n.startsWith("data: ")){var o=n.substring(6).trim();if("[DONE]"===o)return void(t.loading=!1);try{var s,r,i,c=JSON.parse(o),l=(null===(s=c.choices)||void 0===s||null===(r=s[0])||void 0===r||null===(i=r.delta)||void 0===i?void 0:i.content)||"";l&&(a+=l,t.messages[e].content=a,t.$forceUpdate(),t.scrollToBottom())}catch(d){console.error("解析JSON失败:",d,"原始数据:",o)}}})),this.loading=!1}},mounted:function(){this.initVoiceManager()}};e.default=c},3593:function(n,e,t){var a=t("0cb9");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var o=t("967d").default;o("747e3bd9",a,!0,{sourceMap:!1,shadowMode:!1})},4074:function(n,e,t){"use strict";t.r(e);var a=t("50a6"),o=t("c995");for(var s in o)["default"].indexOf(s)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(s);t("82dd");var r=t("828b"),i=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"1b1ec11a",null,!1,a["a"],void 0);e["default"]=i.exports},"50a6":function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return o})),t.d(e,"a",(function(){}));var a=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",{staticClass:"container"},[t("v-uni-scroll-view",{staticClass:"message-list",attrs:{"scroll-y":!0,"scroll-top":n.scrollTop,"scroll-with-animation":!0}},[n._l(n.messages,(function(e,a){return t("v-uni-view",{key:a,staticClass:"message-item",class:["user"===e.role?"user-message":"ai-message"]},[t("v-uni-view",{staticClass:"message-content"},[n._v(n._s(e.content))]),t("v-uni-view",{staticClass:"message-time"},[n._v(n._s(e.time))])],1)})),n.loading?t("v-uni-view",{staticClass:"loading-text"},[n._v("AI正在思考中...")]):n._e()],2),t("v-uni-view",{staticClass:"input-area"},[t("v-uni-button",{staticClass:"voice-btn",class:{recording:n.isRecording},on:{touchstart:function(e){arguments[0]=e=n.$handleEvent(e),n.startRecord.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=n.$handleEvent(e),n.stopRecord.apply(void 0,arguments)}}}),t("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入问题",disabled:n.loading},on:{confirm:function(e){arguments[0]=e=n.$handleEvent(e),n.sendMessage.apply(void 0,arguments)}},model:{value:n.inputText,callback:function(e){n.inputText=e},expression:"inputText"}}),t("v-uni-button",{staticClass:"send-button",attrs:{disabled:n.loading},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.sendMessage.apply(void 0,arguments)}}},[n._v(n._s(n.loading?"发送中...":"发送"))])],1)],1)},o=[]},"82dd":function(n,e,t){"use strict";var a=t("3593"),o=t.n(a);o.a},c995:function(n,e,t){"use strict";t.r(e);var a=t("117e"),o=t.n(a);for(var s in a)["default"].indexOf(s)<0&&function(n){t.d(e,n,(function(){return a[n]}))}(s);e["default"]=o.a}}]);