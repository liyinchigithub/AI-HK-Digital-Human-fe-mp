{"version":3,"sources":["uni-app:///main.js","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?f93a","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?2616","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?f7da","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?3de9","uni-app:///pages/home/home.vue","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?31fb","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/pages/home/home.vue?8994"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","showAIPanel","messages","aiPanelMessages","inputText","loading","scrollTop","isRecording","tempFilePath","dir","isExpanded","computed","dirText","components","moFab","moFabTab","methods","handleFabClick","console","handlePanelToggle","sendMessage","session","uniCloud","name","action","baseUrl","result","conversation_id","request_id","uni","userMessage","role","content","time","question","query","timeout","aiResponse","checkAudioFile","filePath","fileInfo","audio","startVoiceInput","format","sampleRate","numberOfChannels","success","fail","endVoiceInput","cloudPath","res","fileID","title","icon","getCurrentTime","handleClosePanel","scrollToBottom"],"mappings":"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","file":"pages/home/home.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/uni-stat/dist/uni-cloud-stat.es.js';;import '@dcloudio/vue-cli-plugin-uni/packages/uni-push/dist/uni-push.es.js';import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/home/home.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./home.vue?vue&type=template&id=92bb8f34&scoped=true&\"\nvar renderjs\nimport script from \"./home.vue?vue&type=script&lang=js&\"\nexport * from \"./home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./home.vue?vue&type=style&index=0&id=92bb8f34&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"92bb8f34\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/home/home.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=template&id=92bb8f34&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.aiPanelMessages, function (item, index) {\n    var $orig = _vm.__get_orig(item)\n    var g0 = !_vm.isExpanded && index < _vm.aiPanelMessages.length - 2\n    return {\n      $orig: $orig,\n      g0: g0,\n    }\n  })\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 消息列表 -->\r\n\t\t<scroll-view class=\"message-list\" scroll-y :scroll-top=\"scrollTop\" :scroll-with-animation=\"true\">\r\n\t\t\t<view v-for=\"(item, index) in messages\" :key=\"index\" class=\"message-item\"\r\n\t\t\t\t:class=\"[item.role === 'user' ? 'user-message' : 'ai-message']\">\r\n\t\t\t\t<view class=\"message-content\">\r\n\t\t\t\t\t{{ item.content }}\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"message-time\">\r\n\t\t\t\t\t{{ item.time }}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"loading\" class=\"loading-text\">AI正在思考中...</view>\r\n\t\t</scroll-view>\r\n\t\t<!-- 输入区域 -->\r\n\t\t<view class=\"input-area\">\r\n\t\t\t\t<input class=\"input\" v-model=\"inputText\" placeholder=\"请输入问题\" @confirm=\"sendMessage\"\r\n\t\t\t\t\t:disabled=\"loading\" />\r\n\t\t\t\t<button class=\"send-button\" @click=\"sendMessage\" :disabled=\"loading\">\r\n\t\t\t\t\t{{ loading ? '发送中...' : '发送' }}\r\n\t\t\t\t</button>\r\n\t\t</view>\r\n\r\n\t\t<moFab v-model:showPanel=\"showAIPanel\" @click=\"handleFabClick\" @panel-toggle=\"handlePanelToggle\">\r\n\t\t\t<template #content>\r\n\t\t\t\t<image src=\"/static/ai语音管家.png\" style=\"width: 60rpx; height: 60rpx;\"></image>\r\n\t\t\t</template>\r\n\t\t\t<template #ai-content>\r\n\t\t\t\t<view class=\"ai-panel-content\">\r\n\t\t\t\t\t<view class=\"close-btn\" @tap=\"handleClosePanel\">×</view>\r\n\t\t\t\t\t<scroll-view class=\"ai-message-list\" scroll-y :style=\"{ maxHeight: isExpanded ? 'none' : '70vh' }\">\r\n\t\t\t\t\t\t<view v-for=\"(item, index) in aiPanelMessages\" :key=\"index\" class=\"message-item\"\r\n\t\t\t\t\t\t\t:class=\"[item.role === 'user' ? 'user-message' : 'ai-message']\">\r\n\t\t\t\t\t\t\t<view class=\"message-content\"\r\n\t\t\t\t\t\t\t\t:class=\"{ collapsed: !isExpanded && index < aiPanelMessages.length - 2 }\">\r\n\t\t\t\t\t\t\t\t{{ item.content }}\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</scroll-view>\r\n\r\n\t\t\t\t\t<!-- 添加展开/收起控制 -->\r\n\t\t\t\t\t<!-- <view v-if=\"aiPanelMessages.length > 1\" class=\"expand-control\" @click=\"isExpanded = !isExpanded\">\r\n\t\t\t\t\t\t{{ isExpanded ? '收起' : '展开历史记录' }}\r\n\t\t\t\t\t</view> -->\r\n\r\n\t\t\t\t\t<!-- 修改语音按钮定位 -->\r\n\t\t\t\t\t<button class=\"voice-btn\" @touchstart=\"startVoiceInput\" @touchend=\"endVoiceInput\"\r\n\t\t\t\t\t\t:class=\"{ recording: isRecording }\"></button>\r\n\t\t\t\t</view>\r\n\t\t\t</template>\r\n\t\t</moFab>\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport moFab from \"@/components/mo-fab/mo-fab.vue\"\r\nimport moFabTab from \"@/components/mo-fab/mo-fab-tabbar.vue\"\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tshowAIPanel: false,\r\n\t\t\tmessages: [], // 主界面消息列表\r\n\t\t\taiPanelMessages: [], // 改为只存储最新AI回复\r\n\t\t\tinputText: '', // 输入内容\r\n\t\t\tloading: false, // 加载状态\r\n\t\t\tscrollTop: 0, // 滚动位置\r\n\t\t\tisRecording: false,\r\n\t\t\ttempFilePath: '',\r\n\t\t\tdir: 1,\r\n\t\t\tisExpanded: false, // 展开状态控制\r\n\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\t// 计算属性，返回当前方向的文本\r\n\t\tdirText() {\r\n\t\t\treturn this.dir == 1 ? '左' : '右'\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tmoFab,\r\n\t\tmoFabTab,\r\n\t},\r\n\tmethods: {\r\n\t\t// 发送消息\r\n\t\thandleFabClick() {\r\n\t\t\tconsole.log('Fab clicked, current showAIPanel:', this.showAIPanel);\r\n\t\t},\r\n\t\t// 发送消息\r\n\t\thandlePanelToggle(state) {\r\n\t\t\tconsole.log('Panel state:', state);\r\n\t\t\tthis.showAIPanel = state;\r\n\t\t},\r\n\t\t// 发送消息\r\n\t\tasync sendMessage() {\r\n\t\t\tif (!this.inputText.trim() || this.loading) return;\r\n\r\n\t\t\t// 获取或创建会话\r\n\t\t\tlet session = uni.getStorageSync('qianfan_session');\r\n\t\t\tif (!session?.conversation_id || !session?.request_id) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst { result } = await uniCloud.callFunction({\r\n\t\t\t\t\t\tname: 'qianfan-chat',\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\taction: 'create_session',\r\n\t\t\t\t\t\t\tbaseUrl: uni.getStorageSync('baseUrl') || 'https://qianfan.baidubce.com' // 添加baseUrl参数\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (result.code === 0) {\r\n\t\t\t\t\t\tsession = {\r\n\t\t\t\t\t\t\tconversation_id: result.data.conversation_id,\r\n\t\t\t\t\t\t\trequest_id: result.data.request_id\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tuni.setStorageSync('qianfan_session', session);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('会话创建失败:', e);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst userMessage = {\r\n\t\t\t\trole: 'user',\r\n\t\t\t\tcontent: this.inputText,\r\n\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t};\r\n\t\t\tthis.messages.push(userMessage);\r\n\t\t\tconst question = this.inputText;\r\n\t\t\tthis.inputText = '';\r\n\t\t\tthis.scrollToBottom();\r\n\r\n\t\t\ttry {\r\n\t\t\t\tthis.loading = true;\r\n\t\t\t\tconst { result } = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'qianfan-chat',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tquery: question,\r\n\t\t\t\t\t\tconversation_id: session.conversation_id,\r\n\t\t\t\t\t\tbaseUrl: uni.getStorageSync('baseUrl') || 'https://qianfan.baidubce.com' // 添加baseUrl参数\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttimeout: 60000\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (result.code === 0) {\r\n\t\t\t\t\tconst aiResponse = result.data.response || '未收到有效回复';\r\n\t\t\t\t\t// 主界面保留完整对话\r\n\t\t\t\t\tthis.messages.push({\r\n\t\t\t\t\t\trole: 'ai',\r\n\t\t\t\t\t\tcontent: aiResponse,\r\n\t\t\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// 弹窗只保留最新AI回复\r\n\t\t\t\t\tthis.aiPanelMessages = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\trole: 'user',\r\n\t\t\t\t\t\t\tcontent: question,  // 使用发送时的question变量\r\n\t\t\t\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\trole: 'ai',\r\n\t\t\t\t\t\t\tcontent: aiResponse,\r\n\t\t\t\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t\t\t\t}];\r\n\r\n\t\t\t\t\tif (result.data?.conversation_id) {\r\n\t\t\t\t\t\tsession.conversation_id = result.data.conversation_id;\r\n\t\t\t\t\t\tuni.setStorageSync('qianfan_session', session);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tthis.messages.push({\r\n\t\t\t\t\trole: 'ai',\r\n\t\t\t\t\tcontent: `出错啦：${error.message}`,\r\n\t\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t\tthis.scrollToBottom();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 新增检查音频文件的方法\r\n\t\tasync checkAudioFile(filePath) {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('正在检查文件:', filePath);\r\n\t\t\t\tconst fileInfo = await uni.getFileInfo({\r\n\t\t\t\t\tfilePath: filePath\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log('音频文件信息:', fileInfo);\r\n\r\n\t\t\t\tif (fileInfo.errMsg === 'getFileInfo:ok') {\r\n\t\t\t\t\tconst audio = uni.createInnerAudioContext();\r\n\t\t\t\t\taudio.src = filePath;\r\n\t\t\t\t\taudio.onError((e) => {\r\n\t\t\t\t\t\tconsole.error('音频播放失败:', e);\r\n\t\t\t\t\t});\r\n\t\t\t\t\taudio.play();\r\n\t\t\t\t\tconsole.log('尝试播放音频...');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error('文件检查失败:', fileInfo.errMsg);\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('文件检查异常:', e);\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 语音处理方法\r\n\t\tstartVoiceInput() {\r\n\t\t\tthis.isRecording = true;\r\n\t\t\tuni.startRecord({\r\n\t\t\t\tformat: 'silk', // 改为silk格式以匹配实际生成的文件\r\n\t\t\t\tsampleRate: 16000, // 设置采样率\r\n\t\t\t\tnumberOfChannels: 1, // 单声道\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tconsole.log('录音成功，临时文件路径:', res.tempFilePath);\r\n\t\t\t\t\tthis.tempFilePath = res.tempFilePath;\r\n\t\t\t\t\t// 立即检查文件是否存在\r\n\t\t\t\t\tthis.checkAudioFile(res.tempFilePath);\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\tconsole.error('录音失败:', err);\r\n\t\t\t\t\tthis.isRecording = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tasync endVoiceInput() {\r\n\t\t\tthis.isRecording = false;\r\n\t\t\tuni.stopRecord({\r\n\t\t\t\tsuccess: () => {\r\n\t\t\t\t\tconsole.log('录音已停止，文件路径:', this.tempFilePath); // 添加日志\r\n\t\t\t\t\t// 可以在这里添加文件检查逻辑\r\n\t\t\t\t\tthis.checkAudioFile(this.tempFilePath);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('开始上传文件...');\r\n\t\t\t\tconst res = await uniCloud.uploadFile({\r\n\t\t\t\t\tfilePath: this.tempFilePath,\r\n\t\t\t\t\tcloudPath: `voice/${Date.now()}.wav`\r\n\t\t\t\t});\r\n\t\t\t\tconsole.log('文件上传结果:', res); // 检查文件是否上传成功\r\n\r\n\t\t\t\tconst { result } = await uniCloud.callFunction({\r\n\t\t\t\t\tname: 'speech-to-text',\r\n\t\t\t\t\tdata: { fileID: res.fileID }\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (result.code === 0) {\r\n\t\t\t\t\t// 将识别结果添加到消息列表\r\n\t\t\t\t\tthis.messages.push({\r\n\t\t\t\t\t\trole: 'user',\r\n\t\t\t\t\t\tcontent: result.text,\r\n\t\t\t\t\t\ttime: this.getCurrentTime()\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.aiPanelMessages.push(msg); // 新增\r\n\t\t\t\t\t// 自动发送识别结果\r\n\t\t\t\t\tthis.inputText = result.text;\r\n\t\t\t\t\tawait this.sendMessage();\r\n\r\n\t\t\t\t\t// 滚动到底部显示最新消息\r\n\t\t\t\t\tthis.scrollToBottom();\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('语音识别失败:', error);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '语音识别失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取当前时间（HH:MM）\r\n\t\tgetCurrentTime() {\r\n\t\t\tconst now = new Date();\r\n\t\t\treturn `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;\r\n\t\t},\r\n\t\thandleClosePanel() {\r\n\t\t\tthis.showAIPanel = false;\r\n\t\t\tconsole.log('关闭弹窗，当前状态：', this.showAIPanel);\r\n\t\t},\r\n\t\t// 滚动到底部\r\n\t\tscrollToBottom() {\r\n\t\t\tthis.$nextTick(() => {\r\n\t\t\t\tconst query = uni.createSelectorQuery().in(this);\r\n\t\t\t\tquery.select('.message-list').boundingClientRect();\r\n\t\t\t\tquery.exec(res => {\r\n\t\t\t\t\tif (res?.[0]?.height) {\r\n\t\t\t\t\t\tthis.scrollTop = res[0].height + Math.random();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n\theight: 100vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\toverflow: hidden;\r\n}\r\n\r\n.message-list {\r\n\tflex: 1;\r\n\tpadding: 20rpx;\r\n\tbackground-color: #f5f5f5;\r\n\twidth: 100vw;\r\n\toverflow-x: hidden;\r\n}\r\n\r\n.message-item {\r\n\tmargin: 20rpx 0;\r\n\tmax-width: 80%;\r\n\twidth: fit-content;\r\n}\r\n\r\n.message-content {\r\n\tpadding-top: 10rpx;\r\n\t/* 增加内容顶部间距 */\r\n\tpadding: 20rpx;\r\n\tborder-radius: 10rpx;\r\n\tfont-size: 28rpx;\r\n\tline-height: 1.5;\r\n\tword-break: break-word;\r\n}\r\n\r\n\r\n.user-message {\r\n\tmargin-left: auto;\r\n\tmargin-right: 25rpx;\r\n}\r\n\r\n.user-message .message-content {\r\n\tbackground-color: #007AFF;\r\n\tcolor: white;\r\n\tmax-width: 100%;\r\n\tpadding: 20rpx 25rpx;\r\n}\r\n\r\n.ai-message .message-content {\r\n\tbackground-color: #FFFFFF;\r\n\tborder: 1rpx solid #eee;\r\n}\r\n\r\n.message-time {\r\n\tfont-size: 20rpx;\r\n\tcolor: #999;\r\n\tmargin-top: 10rpx;\r\n\ttext-align: right;\r\n}\r\n\r\n.input-area {\r\n  display: flex;\r\n  padding: 20rpx;\r\n  background-color: #fff;\r\n  border-top: 1rpx solid #eee;\r\n}\r\n\r\n.input {\r\n  flex: 1;\r\n  border: 1rpx solid #ddd;\r\n  border-radius: 40rpx;\r\n  padding: 15rpx 30rpx;\r\n  margin-right: 20rpx;  \r\n}\r\n\r\n.send-button {\r\n  background-color: #007AFF;\r\n  color: white;\r\n  border-radius: 40rpx;\r\n  padding: 0 40rpx;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.send-button[disabled] {\r\n  opacity: 0.6;\r\n}\r\n\r\n.loading-text {\r\n  color: #999;\r\n  text-align: center;\r\n  padding: 20rpx;\r\n}\r\n\r\n/* AI悬浮窗口样式 */\r\n.ai-panel {\r\n\tposition: fixed;\r\n\ttop: 50%;\r\n\tleft: 50%;\r\n\ttransform: translate(-50%, -50%);\r\n\twidth: 90%;\r\n\theight: 85%;\r\n\tbackground: white;\r\n\tborder-radius: 20rpx;\r\n\tbox-shadow: 0 0 30rpx rgba(0, 0, 0, 0.2);\r\n\tz-index: 999;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.ai-panel-header {\r\n\theight: 30%;\r\n\tposition: relative;\r\n}\r\n\r\n.ai-gif {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n\r\n.close-btn {\r\n\tposition: absolute;\r\n\tright: 20rpx;\r\n\ttop: 20rpx;\r\n\tfont-size: 40rpx;\r\n\twidth: 50rpx;\r\n\theight: 50rpx;\r\n\ttext-align: center;\r\n\tline-height: 50rpx;\r\n\tbackground: rgba(0, 0, 0, 0.2);\r\n\tborder-radius: 50%;\r\n\tcolor: white;\r\n}\r\n\r\n.ai-panel-content {\r\n\tposition: relative;\r\n\theight: 90vh;\r\n\tpadding: 0 20rpx 150rpx;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n\t/* 新增垂直居中 */\r\n}\r\n\r\n.ai-message-list {\r\n\twidth: 100%;\r\n\t/* 使用全宽 */\r\n\tpadding: 0 20rpx;\r\n\t/* 添加左右内边距 */\r\n\tmax-height: 80vh !important;\r\n}\r\n\r\n.message-item {\r\n\tmargin: 0 0 20rpx;\r\n\t/* 调整外边距 */\r\n\twidth: 100%;\r\n}\r\n\r\n/* 弹窗用户消息样式 */\r\n.ai-panel-content .user-message .message-content {\r\n\tbackground: transparent !important;\r\n\t/* 移除背景 */\r\n\tborder: none !important;\r\n\t/* 移除边框 */\r\n\tcolor: #2B85E4;\r\n\tmargin: 10rpx 0;\r\n\t/* 简化边距 */\r\n\tpadding: 10rpx;\r\n\t/* 减少内边距 */\r\n\tbox-shadow: none !important;\r\n\t/* 移除阴影 */\r\n}\r\n\r\n/* 弹窗AI消息样式 */\r\n.ai-panel-content .ai-message .message-content {\r\n\tbackground: transparent !important;\r\n\tborder: none !important;\r\n\tcolor: #333;\r\n\tmargin: 10rpx 0;\r\n\tpadding: 10rpx;\r\n\tbox-shadow: none !important;\r\n}\r\n\r\n/* 调整折叠条件 */\r\n.message-content.collapsed {\r\n\t-webkit-line-clamp: 3;\r\n\t/* 显示更多行数 */\r\n\tmax-height: 120rpx;\r\n}\r\n\r\n/* 展开控制按钮 */\r\n.expand-control {\r\n\ttext-align: center;\r\n\tcolor: #007AFF;\r\n\tpadding: 10rpx;\r\n\tfont-size: 24rpx;\r\n}\r\n\r\n.voice-btn {\r\n\tposition: fixed;\r\n\tmargin-top: 20rpx;\r\n\tbottom: 40rpx;\r\n\t/* 增加底部间距 */\r\n\tleft: 50%;\r\n\ttransform: translateX(-50%) scale(1);\r\n\twidth: 150rpx;\r\n\theight: 150rpx;\r\n\tborder-radius: 50%;\r\n\tbackground: linear-gradient(90deg, #CD56FF, #833AD6);\r\n\tborder: 4rpx solid rgba(250, 121, 255, 0.8);\r\n\tbox-shadow: 0px 7rpx 18rpx 0px rgba(107, 14, 195, 0.38);\r\n\tbackground-image: url('/static/语音.png');\r\n\tbackground-size: 80rpx 80rpx;\r\n\tbackground-position: center;\r\n\tbackground-repeat: no-repeat;\r\n\tz-index: 9999;\r\n\t/* 提升层级 */\r\n}\r\n\r\n.voice-btn.recording {\r\n\tbackground: #ff4d4d;\r\n\tanimation: pulse 1.5s infinite;\r\n\t/* 保持录音状态下的背景图片 */\r\n\tbackground-image: url('/static/语音.png');\r\n\tbackground-size: 80rpx 80rpx;\r\n\tbackground-position: center;\r\n\tbackground-repeat: no-repeat;\r\n}\r\n\r\n@keyframes pulse {\r\n\t0% {\r\n\t\ttransform: translateX(-50%) scale(1);\r\n\t\t/* 保持定位转换 */\r\n\t}\r\n\r\n\t50% {\r\n\t\ttransform: translateX(-50%) scale(1.1);\r\n\t\t/* 合并转换属性 */\r\n\t}\r\n\r\n\t100% {\r\n\t\ttransform: translateX(-50%) scale(1);\r\n\t}\r\n}\r\n</style>","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=style&index=0&id=92bb8f34&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home.vue?vue&type=style&index=0&id=92bb8f34&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1744272965518\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}