{"version":3,"sources":["webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?3fd8","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?ca95","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?d583","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?fef6","uni-app:///uni_modules/uni-pay/components/uni-pay/uni-pay.vue","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?73b1","webpack:////Users/liyinchi/workspace/前端/Dcolud/AI-HK-Digital-Human-fe-mp/uni_modules/uni-pay/components/uni-pay/uni-pay.vue?6d05"],"names":["name","emits","props","adpid","Type","default","toSuccessPage","returnUrl","mainColor","mode","logo","height","debug","data","options","res","images","wxpay","alipay","originalRroviders","currentProviders","openid","mounted","myOpenid","code","provider","methods","open","providers","createOrder","Object","createOrderData","total_fee","order_no","out_trade_no","description","type","qr_code","custom","other","wxpay_virtual","biz_type","uniPayCo","orderPayment","uni","success","fail","console","openPopup","closePopup","getOrder","refund","getRefund","closeOrder","getPayProviderFromCloud","getProviderAppId","getOpenid","verifyReceiptFromAppleiap","getCode","jsSdk","paySuccess","pageToSuccess","url","clearQrcode","_getOrder","await_notify","_afreshPayment","_pcChooseProvider","_appleiapCreateOrder","appleiap","products","title","productList","productInfo","productid","username","requestPaymentRes","transaction_receipt","transaction_identifier","verifyRes","appleiapRestore","transactions","i","appleiapSdk","addAppleiapOrder","list","getAppleiapUserName","removeAppleiapOrder","watch","computed","modeCom"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgI;AAChI;AAC2D;AACL;AACsC;;;AAG5F;AACyN;AACzN,gBAAgB,iNAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,8FAAM;AACR,EAAE,uGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,kGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,aAAa,qRAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACnEA;AAAA;AAAA;AAAA;AAAk3B,CAAgB,qyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;AC8Ft4B;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFA;AACA;AAEA;AAAA,eAKA;EACAA;EACAC;EACAC;IACA;AACA;AACA;IACAC;MACAC;MACAC;IACA;IACA;AACA;AACA;IACAC;MACAF;MACAC;IACA;IACA;AACA;AACA;IACAE;MACAH;MACAC;IACA;IACA;AACA;AACA;AACA;IACAG;MACAJ;MACAC;IACA;IACA;AACA;AACA;AACA;AACA;IACAI;MACAL;MACAC;IACA;IACA;AACA;AACA;IACAK;MACAN;MACAC;IACA;IACA;AACA;AACA;IACAM;MACAP;MACAC;IACA;IACA;AACA;AACA;IACAO;MACAR;MACAC;IACA;EACA;EACAQ;IACA;MACA;MACAC;MACA;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IAAA;IAAA;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA,IAGAC;gBAAA;gBAAA;cAAA;cAAA;cAAA,OAEA;YAAA;cAAAC;cAAA;cAAA,OACA;gBACAC;gBACAD;cACA;YAAA;cAHAT;cAIA;gBACAQ;gBACA;cACA;YAAA;cAuBA;cACA;cACA;cAOA;gBACAP;gBACAG;gBACAC;cAIA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EACA;EACAM;IACA;IACAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAb;gBACA;kBACAc;kBACA;oBACA;sBACAA;oBACA;kBACA;kBACA;kBACA;gBACA;kBACA;gBACA;gBACA;gBACA;kBACA;oBAAAH;kBAAA;gBACA;kBACA;oBACA;kBACA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAI;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAhB;gBACAC;gBACAgB;gBAAA,MACAhB;kBAAA;kBAAA;gBAAA;gBAAA,kCAEA;cAAA;gBAQAiB;kBACAN;kBACAO;kBACAX;kBACAY;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBACAC;kBAAA;kBACAC;gBACA;;gBACA;kBACAV;gBACA;gBAAA;gBAAA;gBAAA,OAKAW;cAAA;gBAAA3B;gBACA;kBACA;kBACA;oBACA;oBACA;oBACA;sBACA;sBACA;oBACA;sBACA;oBACA;kBACA;oBACA;oBACA;kBACA;gBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IACA;IACA4B;MAAA;MACA;MACA;QACA;MACA;QA4BA;UACAC,0DACA7B;YACA8B;cACA;YACA;YACAC;cACA;gBACA;gBAC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","file":"uni_modules/uni-pay/components/uni-pay/uni-pay.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uni-pay.vue?vue&type=template&id=1f87f297&scoped=true&\"\nvar renderjs\nimport script from \"./uni-pay.vue?vue&type=script&lang=js&\"\nexport * from \"./uni-pay.vue?vue&type=script&lang=js&\"\nimport style0 from \"./uni-pay.vue?vue&type=style&index=0&id=1f87f297&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1f87f297\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/uni-pay/components/uni-pay/uni-pay.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./uni-pay.vue?vue&type=template&id=1f87f297&scoped=true&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniList: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-list/components/uni-list/uni-list\" */ \"@/uni_modules/uni-list/components/uni-list/uni-list.vue\"\n      )\n    },\n    uniListItem: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-list/components/uni-list-item/uni-list-item\" */ \"@/uni_modules/uni-list/components/uni-list-item/uni-list-item.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.modeCom === \"pc\" ? (_vm.options.total_fee / 100).toFixed(2) : null\n  var g1 = _vm.modeCom === \"pc\" ? _vm.currentProviders.indexOf(\"wxpay\") : null\n  var g2 = _vm.modeCom === \"pc\" ? _vm.currentProviders.indexOf(\"alipay\") : null\n  var g3 = !(_vm.modeCom === \"pc\")\n    ? (_vm.options.total_fee / 100).toFixed(2)\n    : null\n  var g4 = !(_vm.modeCom === \"pc\")\n    ? _vm.currentProviders.indexOf(\"wxpay\")\n    : null\n  var g5 = (_vm.options.total_fee / 100).toFixed(2)\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        g2: g2,\n        g3: g3,\n        g4: g4,\n        g5: g5,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./uni-pay.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./uni-pay.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"uni-pay\" >\r\n\r\n\t\t<!-- PC版收银台弹窗开始 -->\r\n\t\t<uni-popup v-if=\"modeCom === 'pc'\" ref=\"payPopup\" type=\"center\" :safe-area=\"false\">\r\n\t\t\t<view class=\"pc-pay-popup\">\r\n\t\t\t\t<view class=\"pc-pay-popup-title\">收银台</view>\r\n\t\t\t\t<view class=\"pc-pay-popup-flex\">\r\n\t\t\t\t\t<view class=\"pc-pay-popup-qrcode-box\">\r\n\t\t\t\t\t\t<image class=\"pc-pay-popup-qrcode-image\" :src=\"res.qr_code_image\"></image>\r\n\t\t\t\t\t\t<view class=\"pc-pay-popup-amount-box\">\r\n\t\t\t\t\t\t\t<view class=\"pc-pay-popup-amount-tips\">扫一扫付款</view>\r\n\t\t\t\t\t\t\t<view class=\"pc-pay-popup-amount\">{{ (options.total_fee / 100).toFixed(2) }}</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"pc-pay-popup-complete-button\" v-if=\"res.qr_code_image\">\r\n\t\t\t\t\t\t\t<button type=\"primary\" @click=\"_getOrder()\">我已完成支付</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"pc-pay-popup-provider-list\">\r\n\t\t\t\t\t\t<view class=\"pc-pay-popup-provider-item\" v-if=\"currentProviders.indexOf('wxpay') > -1\" :class=\"options.provider == 'wxpay' ? 'active' : ''\" @click=\"_pcChooseProvider('wxpay')\">\r\n\t\t\t\t\t\t\t<image :src=\"images.wxpay\" class=\"pc-pay-popup-provider-image\"></image>\r\n\t\t\t\t\t\t\t<text class=\"pc-pay-popup-provider-text\">微信支付</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"pc-pay-popup-provider-item\" v-if=\"currentProviders.indexOf('alipay') > -1\" :class=\"options.provider == 'alipay' ? 'active' : ''\" @click=\"_pcChooseProvider('alipay')\">\r\n\t\t\t\t\t\t\t<image :src=\"images.alipay\" class=\"pc-pay-popup-provider-image\"></image>\r\n\t\t\t\t\t\t\t<text class=\"pc-pay-popup-provider-text\">支付宝支付</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"pc-pay-popup-logo\">\r\n\t\t\t\t\t\t\t<image :src=\"logo\" mode=\"widthFix\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<!-- PC版收银台弹窗结束 -->\r\n\t\t\r\n\t\t<!-- 手机版收银台弹窗开始 -->\r\n\t\t<uni-popup v-else ref=\"payPopup\" type=\"bottom\" :safe-area=\"false\">\r\n\t\t\t<view class=\"mobile-pay-popup\" :style=\"'min-height: '+height+';'\">\r\n\t\t\t\t<view class=\"mobile-pay-popup-title\">收银台</view>\r\n\t\t\t\t<view class=\"mobile-pay-popup-amount-box\">\r\n\t\t\t\t\t<view>待支付金额：</view>\r\n\t\t\t\t\t<view class=\"mobile-pay-popup-amount\">{{ (options.total_fee / 100).toFixed(2) }}</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"mobile-pay-popup-provider-list\">\r\n\t\t\t\t\t<uni-list>\r\n\t\t\t\t\t\t<!-- #ifdef MP-WEIXIN || H5 || APP -->\r\n\t\t\t\t\t\t<uni-list-item v-if=\"currentProviders.indexOf('wxpay') > -1\" :thumb=\"images.wxpay\" title=\"微信支付\" @click=\"createOrder({ provider: 'wxpay' })\" clickable link></uni-list-item>\r\n\t\t\t\t\t\t<!-- #endif -->\r\n\t\t\t\t\t\t<!-- #ifdef MP-ALIPAY || H5 || APP -->\r\n\t\t\t\t\t\t<uni-list-item v-if=\"currentProviders.indexOf('alipay') > -1\" :thumb=\"images.alipay\" title=\"支付宝\" @click=\"createOrder({ provider: 'alipay' })\" clickable link></uni-list-item>\r\n\t\t\t\t\t\t<!-- #endif -->\r\n\t\t\t\t\t</uni-list>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<!-- 手机版收银台弹窗结束 -->\r\n\r\n\t\t<!-- 二维码支付弹窗开始 -->\r\n\t\t<uni-popup ref=\"qrcodePopup\" type=\"center\" :safe-area=\"false\" :animation=\"false\" :mask-click=\"false\" @close=\"clearQrcode\">\r\n\t\t\t<view class=\"qrcode-popup-content\">\r\n\t\t\t\t<image :src=\"res.qr_code_image\" class=\"qrcode-image\"></image>\r\n\t\t\t\t<view class=\"qrcode-popup-info\">\r\n\t\t\t\t\t<view>\r\n\t\t\t\t\t\t<text class=\"qrcode-popup-info-fee\">{{ (options.total_fee / 100).toFixed(2) }}</text>\r\n\t\t\t\t\t\t<text>元</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-if=\"options.provider == 'wxpay'\">请用微信扫码支付</view>\r\n\t\t\t\t\t<view v-else-if=\"options.provider == 'alipay'\">请用支付宝扫码支付</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<button type=\"primary\" @click=\"_getOrder()\">我已完成支付</button>\r\n\t\t\t\t<view class=\"qrcode-popup-cancel\" @click=\"closePopup('qrcodePopup')\">暂不支付</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<!-- 二维码支付弹窗结束 -->\r\n\r\n\t\t<!-- 外部浏览器确认支付弹窗开始 -->\r\n\t\t<uni-popup ref=\"payConfirmPopup\" type=\"center\" :safe-area=\"false\" :animation=\"false\" :mask-click=\"false\">\r\n\t\t\t<view class=\"pay-confirm-popup-content\">\r\n\t\t\t\t<view class=\"pay-confirm-popup-title\">请确认支付是否已完成</view>\r\n\t\t\t\t<view><button type=\"primary\" @click=\"_getOrder()\">已完成支付</button></view>\r\n\t\t\t\t<view class=\"pay-confirm-popup-refresh\"><button type=\"default\" @click=\"_afreshPayment()\">支付遇到问题，重新支付</button></view>\r\n\t\t\t\t<view class=\"pay-confirm-popup-cancel\" @click=\"closePopup('payConfirmPopup')\">暂不支付</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t<!-- 外部浏览器确认支付弹窗结束 -->\r\n\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t// 引入支付云对象\r\n\tconst uniPayCo = uniCloud.importObject(\"uni-pay-co\");\r\n\timport jsSdk from \"../../js_sdk/js_sdk.js\"\r\n\tvar myOpenid; // 将openid临时缓存，避免重复获取openid\r\n\t// #ifdef APP\r\n\timport appleiapSdk from \"../../js_sdk/appleiap.js\"\r\n\t// #endif\r\n\r\n\texport default {\r\n\t\tname: \"uni-pay\",\r\n\t\temits: [\"success\", \"cancel\", \"fail\", \"create\", \"mounted\",\"qrcode\"],\r\n\t\tprops: {\r\n\t\t\t/**\r\n\t\t\t * Banner广告位id\r\n\t\t\t */\r\n\t\t\tadpid: {\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 是否自动跳转到插件内置的支付成功页面（具有看广告功能，可以增加开发者收益）默认true\r\n\t\t\t */\r\n\t\t\ttoSuccessPage:{\r\n\t\t\t\tType: Boolean,\r\n\t\t\t\tdefault: true\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 支付成功后，点击查看订单按钮时跳转的页面地址\r\n\t\t\t */\r\n\t\t\treturnUrl:{\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 支付结果页主色调，默认支付宝小程序为#108ee9，其他端均为#01be6e\r\n\t\t\t * 建议：绿色系 #01be6e 蓝色系 #108ee9 咖啡色 #816a4e 粉红 #fe4070 橙黄 #ffac0c 橘黄 #ff7100\r\n\t\t\t */\r\n\t\t\tmainColor:{\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 收银台模式\r\n\t\t\t * mobile 手机版\r\n\t\t\t * pc 电脑版\r\n\t\t\t */\r\n\t\t\tmode:{\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: \"\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * PC收银台模式时，展示的logo\r\n\t\t\t */\r\n\t\t\tlogo:{\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: \"/static/logo.png\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 收银台高度（默认70vh）\r\n\t\t\t */\r\n\t\t\theight: {\r\n\t\t\t\tType: [String],\r\n\t\t\t\tdefault: \"70vh\"\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 是否打印运行过程日志\r\n\t\t\t */\r\n\t\t\tdebug: {\r\n\t\t\t\tType: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 支付参数\r\n\t\t\t\toptions: {},\r\n\t\t\t\t// 支付云对象返回结果\r\n\t\t\t\tres: {},\r\n\t\t\t\timages: {\r\n\t\t\t\t\twxpay: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAABC9JREFUeF7tWk1a20AMlUzv0bDr13AAYAOcpLCBcoqQU1DYEE6C2QAHIP26q3sPPOqniU2cZMYj+SeGxN5kEXlm9ObpjaQxwpY/uOX+Qw9Az4AtR6APgS0nQC+CfQi0FQLfrvcHXwAGPP4bQMK/fy5f7O9HehphwPfb/dOIogEhHQHBcamDCDESPoIxMQPTNSi1ABj+OrwDpNMaO5og4P2bMZOugFADwNTewWhU0/FVzAgnKZnxuoFQAbB3vX9MET7U2PHgq4R09vv8ZRI0bMhADMDw9uAhGN8NLQrWyAYRAGt1PgcRIU5TOms7JIIAdOL8nElJauikTRBKAdi7ObwioFFTzHaMw3mBzRV8DwKOXy+ertpagxcAq/YR/g2d6TlNrUDu4EiiE0Why4T1rgyINoXRC4DgjE+mF8+7RYAkp4RrRyVztRUKTgCkuz89fz4pAiB5z7WbklBrKxScAEgWxI6joZPXy5c4B0H0nkPdhzcHFIxxhHgZ8OA7AgMnAMObA479UnF6H5twQpF5RBMdibPDvB4AAAL6IZ0rNbTb9IngAyC8IwJ0K5okQBgzqFEKSV4wcXg17bxl8fIiJXFc0bHAgYLjYlHEFaZlVUQDoAIbcVZaN1VRrgAgUfImASiKW6Yh4pAohmHVQqpLABI0dMYiKhJPCeoV0ueuQsDmEJrkSeJ/bqNJnOqfApqVzWznzrdYWkvzhnUDYGnPKLTdV5gpfLiOqJUIaTefF8RKH6wxtAOX2IdA8NcCmmRItmBLfVF5jRBnR58kGQtWlGUJlBeAxpQ5A4eFKTu/ufLzPQv1f2mRRDiZ/nyyYwYrypI0OlQOc/9PsgshDsh2v+BUwTFnD3K5DglVlD4WlDZEsqywNgiK2F9gQBkLi7EtyV59WhBsiTURCjy5QZMgYRn9cxbZWgCQ+IKlnH2sFQYTURHmCYMgAJaKs9aYPkXNXGK6QhQdt9xeC4UhTC+eV/wVASASmrKj6IMA4NIBMQDsX1VN4IlbuU0K7vmiQS0G5EOpmiW6I1Dpjtp8pYc5yxYVj0RtXcMJcwDFSiqYLh2x+QgqAJwnAuEEydxbkZtdj+fKPVfwbPIq7KngqvMVX4WoAmDBAcH9HTMmXw23s0LJSlPOOsZx0l8VAu/0Fzjuc2Td3aY5zf1VoZgBvPgmvuhoIrFSMSXQThcDoJo0YLxGLfBSv5IINgVC1XxCOb/oZrkTBtRJqkQgKG6ROgPgPbGq/6HVIiYK51WngAj5ikbBhoZi3FALbHmozhlQXFChTc75g6wRM2ufzb9N/IwMcG0wg8HZJf9HBF/tFZnBBBH+cW/BpBDnd4XLDNJcon4oBiiY7jS194mEI0IaSz+12ygAclSYEcXvFsqA3UgANEzqAdCgtYm2PQM2cVc1PvUM0KC1ibY9AzZxVzU+bT0D/gPs/oxfcUEcJAAAAABJRU5ErkJggg==\",\r\n\t\t\t\t\talipay: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA2FJREFUeF7tmU122jAQx2cMB2hp9yULeK+naHISwhJyiIRDBJaQkwRO0fdgEWff0h4ANH0yFc+m+hhbckKNvJUsaX76z4ckhAv/8MLthwggKuDCCUQXuHABxCAYXSC6wIUTiC7wFgL4MPveTaj9optrO+696ya8yeQRQFRAdIEYAxoVBD/PNtdCwHWpDIJwr+1PMCk1DgAkCSx/jHrLsv/p+lfKAp3HzQOYDAqxKtcYBJPtXe/B1Y3TXgmATGst0WIrgAC7JmBINOQsNN8HE0zfVQFlFxzrgFgHNLQOkNJuQ7vrcgkS1CXEua5fgnDj+l+172CX/h59Tbn9Of0qBUE1cGe2ngPhLWeiEH0krFDBT63HC8Cnx/VtFuFDfgl90UOldDvuX4WcSo7lBSD0YuR4H6ebZwRNkRUw9xdSah1G+IzZmW5IW7ERDX/e9Rc+YwerBEMvQo1nrhfqkf/ZuYCxxK5J/t4AjkFQBi71CXxFoFSWq2XTlkn+AndXodNf5SwgT4J7gnttoNL6BqUEmCZET/tkvzQZYj5g1Sf/0goIkfcJYIkEK5HsFnkYnen6BXQptUb5lwJgMz4zCihXD/BqAwVDuoy+Uqx399kACrkZaYECVjY5qxJZXpoQwrcDHB6UghfVvPssAMo35W4R7oZVg5EMmAJxUCZ2CNzfVJ2Pm6qdleDBNwFClaHZdRrQAEhWe25VSPCuAMo1tnQhdIzMNUixfDYBqAOGVQEKQB15OFMCwXPV3QsFww7g73E39Pudr/Gn0EyplQPXCkBF/5AKsBtPKRA+AdKAEx/0BhYLL9nHFkhZLiBvbkOcxFzG5wPtoe7gBUrrTiMttqO+8ebZCkAtWErs17jHvrrSLcj+lkCpKeV5g/ABIA05lqgVM4Er2nPhZgev7DHGnToLG+ALIC9budgWwoRzyuMUPlzj8waVBuELIFOB5iksi7xIKQh8PS4wu8/j+a3vBScbRAgABVfg5BZbH6SFgP0kVIl7UCjNja4RCkAGwecaPLDhp4yNsSYkADlp/mncdNLLu8fpud9XQK7//wERGoBrAefSfgRBsLI9pTtPg+diUNV1yLuJypVg1Un/p/8arwDXZkQALkJNb48KaPoOu+yLCnARanp7VEDTd9hlX1SAi1DT2/8AaakVXysj5qkAAAAASUVORK5CYII=\"\r\n\t\t\t\t},\r\n\t\t\t\toriginalRroviders: [\"wxpay\",\"alipay\"],\r\n\t\t\t\tcurrentProviders: [\"wxpay\",\"alipay\"],\r\n\t\t\t\topenid: \"\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync mounted() {\r\n\t\t\tlet code;\r\n\t\t\tlet res;\r\n\t\t\tif (!myOpenid) {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tcode = await this.getCode();\r\n\t\t\t\tres = await this.getOpenid({\r\n\t\t\t\t\tprovider: \"wxpay\",\r\n\t\t\t\t\tcode\r\n\t\t\t\t});\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tmyOpenid = res.openid;\r\n\t\t\t\t\tthis.openid = res.openid;\r\n\t\t\t\t} \r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef MP-ALIPAY\r\n\t\t\t\tcode = await this.getCode();\r\n\t\t\t\tres = await this.getOpenid({\r\n\t\t\t\t\tprovider: \"alipay\",\r\n\t\t\t\t\tcode\r\n\t\t\t\t});\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tmyOpenid = res.openid;\r\n\t\t\t\t\tthis.openid = res.openid;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t\t// #ifndef MP\r\n\t\t\t// 如果不是小程序，则请求云端获取支持的支付方式\r\n\t\t\tlet getPayProviderFromCloudRes = await this.getPayProviderFromCloud();\r\n\t\t\tif (getPayProviderFromCloudRes.errCode === 0) {\r\n\t\t\t\tthis.originalRroviders = getPayProviderFromCloudRes.provider;\r\n\t\t\t\tthis.currentProviders = JSON.parse(JSON.stringify(this.originalRroviders));\r\n\t\t\t}\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t// 如果是微信小程序，则设置只支持微信支付\r\n\t\t\tthis.originalRroviders = [\"wxpay\"];\r\n\t\t\tthis.currentProviders = JSON.parse(JSON.stringify(this.originalRroviders));\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef MP-ALIPAY\r\n\t\t\t// 如果是支付宝小程序，则设置只支持支付宝支付\r\n\t\t\tthis.originalRroviders = [\"alipay\"];\r\n\t\t\tthis.currentProviders = JSON.parse(JSON.stringify(this.originalRroviders));\r\n\t\t\t// #endif\r\n\t\t\tthis.$emit(\"mounted\", {\r\n\t\t\t\timages: this.images,\r\n\t\t\t\toriginalRroviders: this.originalRroviders,\r\n\t\t\t\tcurrentProviders: this.currentProviders,\r\n\t\t\t\t// #ifdef APP\r\n\t\t\t\tappleiapSdk: appleiapSdk,\r\n\t\t\t\t// #endif\r\n\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 发起支付 - 打开支付选项弹窗\r\n\t\t\tasync open(options = {}) {\r\n\t\t\t\tif (options.provider) {\r\n\t\t\t\t\tlet providers = [];\r\n\t\t\t\t\tthis.originalRroviders.map((item, index) => {\r\n\t\t\t\t\t\tif (options.provider.indexOf(item) > -1) {\r\n\t\t\t\t\t\t\tproviders.push(item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.currentProviders = providers;\r\n\t\t\t\t\tdelete options.provider;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.currentProviders = JSON.parse(JSON.stringify(this.originalRroviders));\r\n\t\t\t\t}\r\n\t\t\t\tthis.options = options;\r\n\t\t\t\tif (this.currentProviders.length === 1) {\r\n\t\t\t\t\tthis.createOrder({ provider: this.currentProviders[0] });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.modeCom === \"pc\") {\r\n\t\t\t\t\t\tthis._pcChooseProvider(this.currentProviders[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.openPopup(\"payPopup\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 创建支付\r\n\t\t\tasync createOrder(data = {}) {\r\n\t\t\t\tlet { options } = this;\r\n\t\t\t\tObject.assign(options, data);\r\n\t\t\t\tif (options.provider === \"appleiap\") {\r\n\t\t\t\t\t// ios内购走特殊逻辑\r\n\t\t\t\t\treturn this._appleiapCreateOrder(options);\r\n\t\t\t\t}\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\t// 判断如果是pc访问，则强制扫码模式\r\n\t\t\t\tif ([\"pc\", \"pc-weixin\"].indexOf(jsSdk.checkPlatform()) > -1) {\r\n\t\t\t\t\toptions.qr_code = true;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\tlet createOrderData = {\r\n\t\t\t\t\tprovider: options.provider,\r\n\t\t\t\t\ttotal_fee: options.total_fee,\r\n\t\t\t\t\topenid: myOpenid,\r\n\t\t\t\t\torder_no: options.order_no,\r\n\t\t\t\t\tout_trade_no: options.out_trade_no,\r\n\t\t\t\t\tdescription: options.description,\r\n\t\t\t\t\ttype: options.type,\r\n\t\t\t\t\tqr_code: options.qr_code,\r\n\t\t\t\t\tcustom: options.custom,\r\n\t\t\t\t\tother: options.other,\r\n\t\t\t\t\twxpay_virtual: options.wxpay_virtual, // 微信小程序虚拟支付需要\r\n\t\t\t\t\tbiz_type: options.biz_type, // 华为支付需要\r\n\t\t\t\t};\r\n\t\t\t\tif (myOpenid) {\r\n\t\t\t\t\tcreateOrderData.openid = myOpenid;\r\n\t\t\t\t}\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\tif (options.openid && options.provider === \"wxpay\") createOrderData.openid = options.openid;\r\n\t\t\t\t// #endif\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.createOrder(createOrderData);\r\n\t\t\t\t\tif (!res.errCode) {\r\n\t\t\t\t\t\tthis.$emit(\"create\", res);\r\n\t\t\t\t\t\tif (res.qr_code && !options.cancel_popup) {\r\n\t\t\t\t\t\t\tthis.res = res;\r\n\t\t\t\t\t\t\t// 展示组件内置的二维码弹窗\r\n\t\t\t\t\t\t\tif (this.modeCom === \"pc\") {\r\n\t\t\t\t\t\t\t\tthis.openPopup(\"payPopup\");\r\n\t\t\t\t\t\t\t\tthis._pcChooseProvider(options.provider);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.openPopup(\"qrcodePopup\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 调起支付\r\n\t\t\t\t\t\t\tthis.orderPayment(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.$emit(\"fail\", res);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch(err){\r\n\t\t\t\t\tthis.$emit(\"fail\", err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 调起支付\r\n\t\t\torderPayment(res){\r\n\t\t\t\tthis.res = res;\r\n\t\t\t\tif (res.qr_code) {\r\n\t\t\t\t\tthis.$emit(\"qrcode\", res);\r\n\t\t\t\t} else if (res.order) {\r\n\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\tif (res.provider_pay_type === \"jsapi\") {\r\n\t\t\t\t\t\t// 微信公众号支付\r\n\t\t\t\t\t\tWeixinJSBridge.invoke(\"getBrandWCPayRequest\", res.order, (res) => {\r\n\t\t\t\t\t\t\tif (res.err_msg == \"get_brand_wcpay_request:ok\") {\r\n\t\t\t\t\t\t\t\t// 用户支付成功回调\r\n\t\t\t\t\t\t\t\tthis._getOrder();\r\n\t\t\t\t\t\t\t} else if (res.err_msg == \"get_brand_wcpay_request:cancel\") {\r\n\t\t\t\t\t\t\t\t// 用户取消支付回调\r\n\t\t\t\t\t\t\t\tthis.$emit(\"cancel\", res);\r\n\t\t\t\t\t\t\t} else if (res.err_msg == \"get_brand_wcpay_request:fail\") {\r\n\t\t\t\t\t\t\t\t// 用户支付失败回调\r\n\t\t\t\t\t\t\t\tconsole.error('getBrandWCPayRequest-fail: ', res);\r\n\t\t\t\t\t\t\t\tthis.$emit(\"fail\", res);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 外部浏览器支付\r\n\t\t\t\t\t\tlet codeUrl = res.order.codeUrl;\r\n\t\t\t\t\t\tlet mwebUrl = res.order.h5Url || res.order.mwebUrl || res.order.mweb_url;\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis.openPopup(\"payConfirmPopup\");\r\n\t\t\t\t\t\t\twindow.location.href = codeUrl || mwebUrl;\r\n\t\t\t\t\t\t}, 200);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\tif (res.provider === \"wxpay-virtual\") {\r\n\t\t\t\t\t\tuni.requestVirtualPayment({\r\n\t\t\t\t\t\t\t...res.order,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tthis._getOrder();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tif (err.errMsg.indexOf(\"fail cancel\") == -1) {\r\n\t\t\t\t\t\t\t\t\t// 发起支付失败\r\n\t\t\t\t\t\t\t\t\tconsole.error(\"uni.requestVirtualPayment:fail\", err);\r\n\t\t\t\t\t\t\t\t\tthis.$emit(\"fail\", err);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// 用户取消支付\r\n\t\t\t\t\t\t\t\t\tthis.$emit(\"cancel\", err);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.requestPayment({\r\n\t\t\t\t\t\t\t// #ifdef APP\r\n\t\t\t\t\t\t\tprovider: res.provider, // App端此参数必填，可以通过uni.getProvider获取\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\t\t\t...res.order,\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifdef APP || MP-ALIPAY\r\n\t\t\t\t\t\t\torderInfo: res.order,\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t// #ifdef MP-HARMONY || APP-HARMONY\r\n\t\t\t\t\t\t\torderStr: res.order,\r\n\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t...res.order,\r\n\t\t\t\t\t\t\tsuccess:(res)=>{\r\n\t\t\t\t\t\t\t\tthis._getOrder();\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail:(err)=>{\r\n\t\t\t\t\t\t\t\tif (err.errMsg.indexOf(\"fail cancel\") == -1) {\r\n\t\t\t\t\t\t\t\t\t// 发起支付失败\r\n\t\t\t\t\t\t\t\t\tconsole.error(\"uni.requestPayment:fail\", JSON.stringify(err));\r\n\t\t\t\t\t\t\t\t\tthis.$emit(\"fail\", err);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t// 用户取消支付\r\n\t\t\t\t\t\t\t\t\tthis.$emit(\"cancel\", err);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开弹窗\r\n\t\t\topenPopup(name){\r\n\t\t\t\tif (!this.$refs[name].showPopup) this.$refs[name].open();\r\n\t\t\t},\r\n\t\t\t// 关闭弹窗\r\n\t\t\tclosePopup(name){\r\n\t\t\t\tthis.$refs[name].close();\r\n\t\t\t},\r\n\t\t\t// 查询订单（查询支付情况）\r\n\t\t\tasync getOrder(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.getOrder(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发起退款（此接口需要admin角色才可以访问）\r\n\t\t\tasync refund(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.refund(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 查询退款（查询退款情况）\r\n\t\t\tasync getRefund(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.getRefund(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 关闭订单\r\n\t\t\tasync closeOrder(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.closeOrder(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 获取支持的支付供应商\r\n\t\t\tasync getPayProviderFromCloud(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.getPayProviderFromCloud(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 获取支付配置内的appid（主要用于获取获取微信公众号的appid，用以获取code）\r\n\t\t\tasync getProviderAppId(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.getProviderAppId(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 根据code获取openid\r\n\t\t\tasync getOpenid(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.getOpenid(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 验证iosIap苹果内购支付凭据\r\n\t\t\tasync verifyReceiptFromAppleiap(data = {}) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet res = await uniPayCo.verifyReceiptFromAppleiap(data);\r\n\t\t\t\t\tif (typeof data.success === \"function\") data.success(res);\r\n\t\t\t\t\treturn res;\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tif (typeof data.fail === \"function\") data.fail(err);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 获取code\r\n\t\t\tasync getCode() {\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\treturn jsSdk.getWeixinCode();\r\n\t\t\t\t// #endif\r\n\t\t\t\t// #ifdef MP-ALIPAY\r\n\t\t\t\treturn jsSdk.getAlipayCode();\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// 支付成功后的逻辑\r\n\t\t\tpaySuccess(res={}) {\r\n\t\t\t\tthis.closePopup(\"payPopup\");\r\n\t\t\t\tthis.closePopup(\"payConfirmPopup\");\r\n\t\t\t\tthis.clearQrcode();\r\n\t\t\t\tif (this.toSuccessPage){\r\n\t\t\t\t\t// 跳转到支付成功的内置页面\r\n\t\t\t\t\tthis.pageToSuccess(res);\r\n\t\t\t\t}\r\n\t\t\t\tthis.$emit(\"success\", res);\r\n\t\t\t},\r\n\t\t\tpageToSuccess(res){\r\n\t\t\t\tif (this.modeCom !== \"pc\") {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl:`/uni_modules/uni-pay/pages/success/success?out_trade_no=${res.out_trade_no}&order_no=${res.pay_order.order_no}&pay_date=${res.pay_order.pay_date}&total_fee=${res.pay_order.total_fee}&adpid=${this.adpid}&return_url=${this.returnUrl}&main_color=${this.mainColor}`\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this.returnUrl) {\r\n\t\t\t\t\t\tlet url = this.returnUrl + `?out_trade_no=${res.out_trade_no}&order_no=${res.pay_order.order_no}`;\r\n\t\t\t\t\t\tif (url.indexOf(\"/\") !== 0) url = `/${url}`;\r\n\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\turl,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 监听 - 关闭二维码弹窗\r\n\t\t\tclearQrcode() {\r\n\t\t\t\tthis.res.codeUrl = \"\";\r\n\t\t\t\tthis.res.qr_code_image = \"\";\r\n\t\t\t},\r\n\t\t\t// 内部函数查询支付状态\r\n\t\t\tasync _getOrder() {\r\n\t\t\t\tthis.getOrder({\r\n\t\t\t\t\tout_trade_no: this.res.out_trade_no,\r\n\t\t\t\t\tawait_notify: true,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.has_paid) {\r\n\t\t\t\t\t\t\tthis.closePopup(\"qrcodePopup\");\r\n\t\t\t\t\t\t\tthis.paySuccess(res);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 重新发起支付\r\n\t\t\t_afreshPayment(){\r\n\t\t\t\tthis.orderPayment(this.res);\r\n\t\t\t},\r\n\t\t\t// pc版弹窗选择支付方式\r\n\t\t\t_pcChooseProvider(provider){\r\n\t\t\t\tif (provider === this.options.provider) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treturn this.createOrder({ provider: provider })\r\n\t\t\t},\r\n\t\t\t// ios内购支付逻辑\r\n\t\t\tasync _appleiapCreateOrder(options){\r\n\t\t\t\t// 初始化ios内购商品\r\n\t\t\t\tlet appleiap = new appleiapSdk.Iap({\r\n\t\t\t\t\t// products为苹果开发者后台的商品id数组\r\n\t\t\t\t\tproducts: [options.productid]\r\n\t\t\t\t});\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '加载中...'\r\n\t\t\t\t});\r\n\t\t\t\t// 初始化，获取iap支付通道\r\n\t\t\t\tawait appleiap.init();\r\n\t\t\t\t// 从苹果服务器获取产品列表\r\n\t\t\t\tlet productList = await appleiap.getProduct();\r\n\t\t\t\tlet productInfo = productList[0];\r\n\t\t\t\toptions.total_fee = productInfo.price * 100;\r\n\t\t\t\toptions.description = productInfo.description;\r\n\t\t\t\tlet createOrderData = {\r\n\t\t\t\t\tprovider: options.provider,\r\n\t\t\t\t\ttotal_fee: options.total_fee,\r\n\t\t\t\t\torder_no: options.order_no,\r\n\t\t\t\t\tout_trade_no: options.out_trade_no,\r\n\t\t\t\t\tdescription: options.description,\r\n\t\t\t\t\ttype: options.type,\r\n\t\t\t\t\tcustom: options.custom,\r\n\t\t\t\t};\r\n\t\t\t\tlet res = await uniPayCo.createOrder(createOrderData);\r\n\t\t\t\tif (res.errCode === 0) {\r\n\t\t\t\t\tthis.$emit(\"create\", res);\r\n\t\t\t\t\tthis.res = res;\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: '支付请求中...'\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// 请求苹果支付\r\n\t\t\t\t\t\tif (this.debug) console.log(\"正在请求苹果服务器\", options.productid, res.out_trade_no);\r\n\t\t\t\t\t\tlet requestPaymentRes = await appleiap.requestPayment({\r\n\t\t\t\t\t\t\tproductid: options.productid,\r\n\t\t\t\t\t\t\tusername: res.out_trade_no\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (this.debug) console.log('用户支付成功', requestPaymentRes);\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '正在处理支付结果...'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!requestPaymentRes.payment.username) {\r\n\t\t\t\t\t\t\trequestPaymentRes.payment.username = this.getAppleiapUserName(requestPaymentRes);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!requestPaymentRes.payment.username) {\r\n\t\t\t\t\t\t\t// 如果运行到了这里，代表这单丢失了username，只能做丢单处理，否则用户会一直卡在丢单检测\r\n\t\t\t\t\t\t\t// 完结订单\r\n\t\t\t\t\t\t\tawait appleiap.finishTransaction(requestPaymentRes);\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tconsole.log(`您可能已支付成功，但很抱歉丢单了，请联系客服处理。`, requestPaymentRes);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// 将凭据和username缓存起来\r\n\t\t\t\t\t\tthis.addAppleiapOrder(requestPaymentRes);\r\n\t\t\t\t\t\t// 云端请求苹果服务器验证票据\r\n\t\t\t\t\t\tlet verifyRes = await this.verifyReceiptFromAppleiap({\r\n\t\t\t\t\t\t\tout_trade_no: requestPaymentRes.payment.username,\r\n\t\t\t\t\t\t\ttransaction_receipt: requestPaymentRes.transactionReceipt,\r\n\t\t\t\t\t\t\ttransaction_identifier: requestPaymentRes.transactionIdentifier\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (verifyRes.errCode === 0) {\r\n\t\t\t\t\t\t\t// 完结订单\r\n\t\t\t\t\t\t\tawait appleiap.finishTransaction(requestPaymentRes);\r\n\t\t\t\t\t\t\tthis.removeAppleiapOrder(requestPaymentRes);\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tthis.paySuccess(verifyRes);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\tlet code = err.errCode || err.code;\r\n\t\t\t\t\t\tif (code === 2) {\r\n\t\t\t\t\t\t\t// 用户取消支付\r\n\t\t\t\t\t\t\tif (this.debug) console.log(\"用户取消支付\");\r\n\t\t\t\t\t\t\tthis.$emit(\"cancel\", err);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// 发起支付失败\r\n\t\t\t\t\t\t\tconsole.error(\"appleiapCreateOrder:fail\", err);\r\n\t\t\t\t\t\t\tthis.$emit(\"fail\", err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// ios内购支付漏单重试\r\n\t\t\tasync appleiapRestore(){\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '检测支付环境...'\r\n\t\t\t\t});\r\n\t\t\t\t// 初始化\r\n\t\t\t\tlet appleiap = new appleiapSdk.Iap();\r\n\t\t\t\t// 初始化，获取iap支付通道\r\n\t\t\t\tawait appleiap.init();\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (this.debug) console.log(\"正在查询是否有漏单信息\");\r\n\t\t\t\t\tconst transactions = await appleiap.restoreCompletedTransactions({\r\n\t\t\t\t\t\tusername: \"\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (this.debug) console.log('漏单查询结果：' + (transactions.length === 0 ? '未漏单' : \"有漏单\"), transactions);\r\n\t\t\t\t\tif (!transactions.length) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 开发者业务逻辑，从服务器获取当前用户未完成的订单列表，和本地的比较\r\n\t\t\t\t\tfor (let i = 0; i < transactions.length; i++) {\r\n\t\t\t\t\t\tlet requestPaymentRes = transactions[i];\r\n\t\t\t\t\t\tswitch (requestPaymentRes.transactionState) {\r\n\t\t\t\t\t\t\tcase appleiapSdk.IapTransactionState.purchased:\r\n\t\t\t\t\t\t\t\t// 云端请求苹果服务器验证票据\r\n\t\t\t\t\t\t\t\tif (!requestPaymentRes.payment.username) {\r\n\t\t\t\t\t\t\t\t\trequestPaymentRes.payment.username = this.getAppleiapUserName(requestPaymentRes);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (!requestPaymentRes.payment.username) {\r\n\t\t\t\t\t\t\t\t\t// 如果运行到了这里，代表这单丢失了username，只能做丢单处理，否则用户会一直卡在丢单检测\r\n\t\t\t\t\t\t\t\t\t// 完结订单\r\n\t\t\t\t\t\t\t\t\tawait appleiap.finishTransaction(requestPaymentRes);\r\n\t\t\t\t\t\t\t\t\tconsole.log(`您可能已支付成功，但很抱歉丢单了，请联系客服处理。`, requestPaymentRes);\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tconsole.log('requestPaymentRes: ', requestPaymentRes);\r\n\t\t\t\t\t\t\t\tlet verifyRes = await this.verifyReceiptFromAppleiap({\r\n\t\t\t\t\t\t\t\t\tout_trade_no: requestPaymentRes.payment.username,\r\n\t\t\t\t\t\t\t\t\ttransaction_receipt: requestPaymentRes.transactionReceipt,\r\n\t\t\t\t\t\t\t\t\ttransaction_identifier: requestPaymentRes.transactionIdentifier\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tconsole.log('verifyRes: ', verifyRes);\r\n\t\t\t\t\t\t\t\tif (verifyRes.errCode === 0) {\r\n\t\t\t\t\t\t\t\t\t// 完结订单\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"完结订单：\"+requestPaymentRes.payment.username);\r\n\t\t\t\t\t\t\t\t\tawait appleiap.finishTransaction(requestPaymentRes);\r\n\t\t\t\t\t\t\t\t\tthis.removeAppleiapOrder(requestPaymentRes);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase appleiapSdk.IapTransactionState.failed:\r\n\t\t\t\t\t\t\t\t// 关闭未支付的订单\r\n\t\t\t\t\t\t\t\tawait appleiap.finishTransaction(requestPaymentRes);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 保存ios内购订单至本地缓存（丢单时可找回username）\r\n\t\t\taddAppleiapOrder(requestPaymentRes){\r\n\t\t\t\tlet key = \"uni-pay-appleiap-order\";\r\n\t\t\t\tlet list = uni.getStorageSync(key) || [];\r\n\t\t\t\tlist.push(requestPaymentRes);\r\n\t\t\t\tuni.setStorageSync(key, list);\r\n\t\t\t},\r\n\t\t\t// 从本地缓存中根据订单信息获取username\r\n\t\t\tgetAppleiapUserName(requestPaymentRes){\r\n\t\t\t\tlet key = \"uni-pay-appleiap-order\";\r\n\t\t\t\tlet list = uni.getStorageSync(key) || [];\r\n\t\t\t\tlet info = list.find((item) => {\r\n\t\t\t\t\treturn item.transactionIdentifier === requestPaymentRes.transactionIdentifier && item.transactionDate === requestPaymentRes.transactionDate;\r\n\t\t\t\t});\r\n\t\t\t\tlet username = info && info.payment && info.payment.username;\r\n\t\t\t\treturn username;\r\n\t\t\t},\r\n\t\t\t// 从本地缓存中删除ios内购订单\r\n\t\t\tremoveAppleiapOrder(requestPaymentRes){\r\n\t\t\t\tlet key = \"uni-pay-appleiap-order\";\r\n\t\t\t\tlet list = uni.getStorageSync(key) || [];\r\n\t\t\t\tlet index = list.findIndex((item) => {\r\n\t\t\t\t\treturn item.transactionIdentifier === requestPaymentRes.transactionIdentifier && item.transactionDate === requestPaymentRes.transactionDate;\r\n\t\t\t\t});\r\n\t\t\t\tif (index > -1) {\r\n\t\t\t\t\tlist.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t\tuni.setStorageSync(key, list);\r\n\t\t\t},\r\n\t\t},\r\n\t\twatch: {\r\n\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tmodeCom(){\r\n\t\t\t\tif (this.mode) return this.mode;\r\n\t\t\t\tlet systemInfo = uni.getSystemInfoSync();\r\n\t\t\t\treturn systemInfo && systemInfo.deviceType === \"pc\" ? \"pc\" : \"mobile\";\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n\t.uni-pay {\r\n\t\t--bgcolor: #f3f3f3;\r\n\t}\r\n\r\n\t/* 手机版收银台弹窗开始 */\r\n\t.mobile-pay-popup {\r\n\t\tmin-height: 70vh;\r\n\t\tbackground-color: var(--bgcolor);\r\n\t\tborder-radius: 30rpx 30rpx 0 0;\r\n\t\toverflow: hidden;\r\n\r\n\t\t.mobile-pay-popup-title {\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tfont-size: 40rpx;\r\n\t\t\tpadding: 20rpx;\r\n\t\t}\r\n\r\n\t\t.mobile-pay-popup-amount-box {\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\tpadding: 30rpx;\r\n\r\n\t\t\t.mobile-pay-popup-amount {\r\n\t\t\t\tcolor: #e43d33;\r\n\t\t\t\tfont-size: 60rpx;\r\n\t\t\t\tmargin-top: 20rpx;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.mobile-pay-popup-provider-list {\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\tmargin-top: 20rpx;\r\n\t\t}\r\n\t}\r\n\t/* 手机版收银台弹窗结束 */\r\n\r\n\t/* PC版收银台弹窗开始 */\r\n\t.pc-pay-popup {\r\n\t\twidth: 800px;\r\n\t\theight: 600px;\r\n\t\tbackground-color: var(--bgcolor);\r\n\t\tborder-radius: 10px;\r\n\t\toverflow: hidden;\r\n\t\t.pc-pay-popup-title{\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tfont-size: 20px;\r\n\t\t\theight: 66px;\r\n\t\t\tline-height: 66px;\r\n\t\t}\r\n\t\t.pc-pay-popup-flex{\r\n\t\t\twidth: 100%;\r\n\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\tdisplay: flex;\r\n\t\t\t/* #endif */\r\n\t\t\t.pc-pay-popup-qrcode-box{\r\n\t\t\t\theight: calc(600px - 66px);\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\t/* #endif */\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\t.pc-pay-popup-qrcode-image{\r\n\t\t\t\t\twidth: 225px;\r\n\t\t\t\t\theight: 225px;\r\n\t\t\t\t}\r\n\t\t\t\t.pc-pay-popup-amount-box{\r\n\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t.pc-pay-popup-amount-tips{\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\tfont-size: 20px;\r\n\t\t\t\t\t\tmargin-top: 20px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.pc-pay-popup-amount{\r\n\t\t\t\t\t\tcolor: #dd524d;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t\tfont-size: 32px;\r\n\t\t\t\t\t\tmargin-top: 20px;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t.pc-pay-popup-complete-button{\r\n\t\t\t\t\tmargin-top: 20px;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\t.pc-pay-popup-provider-list{\r\n\t\t\t\twidth: 300px;\r\n\t\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\t/* #endif */\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\t.pc-pay-popup-provider-item{\r\n\t\t\t\t\tpadding: 20px;\r\n\t\t\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t/* #endif */\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t.pc-pay-popup-provider-image{\r\n\t\t\t\t\t\twidth: 60px;\r\n\t\t\t\t\t\theight: 60px;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.pc-pay-popup-provider-text{\r\n\t\t\t\t\t\tcolor: #333;\r\n\t\t\t\t\t\tfont-size: 20px;\r\n\t\t\t\t\t\tmargin-left: 10px;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t.pc-pay-popup-provider-item.active{\r\n\t\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\t}\r\n\t\t\t\t.pc-pay-popup-provider-item:hover{\r\n\t\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\t\tcursor: pointer;\r\n\t\t\t\t}\r\n\t\t\t\t.pc-pay-popup-logo{\r\n\t\t\t\t\tflex: 1;\r\n\t\t\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t/* #endif */\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\timage{\r\n\t\t\t\t\t\twidth: 120px;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/* PC版收银台弹窗结束 */\r\n\r\n\t/* 二维码支付弹窗开始 */\r\n\t.qrcode-popup-content {\r\n\t\twidth: 600rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 40rpx;\r\n\t\tbox-sizing: border-box;\r\n\t\ttext-align: center;\r\n\r\n\t\t.qrcode-image {\r\n\t\t\twidth: 450rpx;\r\n\t\t\theight: 450rpx;\r\n\t\t}\r\n\r\n\t\t.qrcode-popup-info {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 20rpx;\r\n\r\n\t\t\t.qrcode-popup-info-fee {\r\n\t\t\t\tcolor: red;\r\n\t\t\t\tfont-size: 60rpx;\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.qrcode-popup-cancel{\r\n\t\t\tmargin-top: 20rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t}\r\n\t/* 二维码支付弹窗结束 */\r\n\r\n\t/* 外部浏览器H5支付弹窗确认开始 */\r\n\t.pay-confirm-popup-content {\r\n\t\twidth: 550rpx;\r\n\t\tbackground-color: #ffffff;\r\n\t\tborder-radius: 10rpx;\r\n\t\tpadding: 40rpx;\r\n\t\t.pay-confirm-popup-title {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 20rpx 0;\r\n\t\t\tmargin-bottom: 30rpx;\r\n\t\t}\r\n\t\t.pay-confirm-popup-refresh{\r\n\t\t\tmargin-top: 20rpx;\r\n\t\t}\r\n\t\t.pay-confirm-popup-cancel{\r\n\t\t\tmargin-top: 20rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t}\r\n\t/* 外部浏览器H5支付弹窗确认结束 */\r\n\r\n</style>\r\n","import mod from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./uni-pay.vue?vue&type=style&index=0&id=1f87f297&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./uni-pay.vue?vue&type=style&index=0&id=1f87f297&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1744256771214\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}